"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WalletController = void 0;
const browser_check_1 = require("@terra-dev/browser-check");
const chrome_extension_1 = require("@terra-dev/chrome-extension");
const readonly_wallet_modal_1 = require("@terra-dev/readonly-wallet-modal");
const use_wallet_1 = require("@terra-dev/use-wallet");
const wallet_types_1 = require("@terra-dev/wallet-types");
const web_connector_controller_1 = require("@terra-dev/web-connector-controller");
const web_connector_interface_1 = require("@terra-dev/web-connector-interface");
const terra_js_1 = require("@terra-money/terra.js");
const fast_deep_equal_1 = __importDefault(require("fast-deep-equal"));
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const env_1 = require("./env");
const chrome_extension_2 = require("./modules/chrome-extension");
const readonly_wallet_1 = require("./modules/readonly-wallet");
const walletconnect_1 = require("./modules/walletconnect");
const checkAvailableExtension_1 = require("./utils/checkAvailableExtension");
const CONNECTIONS = {
    [use_wallet_1.ConnectType.READONLY]: {
        type: use_wallet_1.ConnectType.READONLY,
        name: 'View an address',
        icon: 'https://assets.terra.money/icon/station-extension/icon.png',
    },
    [use_wallet_1.ConnectType.WALLETCONNECT]: {
        type: use_wallet_1.ConnectType.WALLETCONNECT,
        name: 'Terra Station Mobile',
        icon: 'https://assets.terra.money/icon/station-extension/icon.png',
    },
    [use_wallet_1.ConnectType.WEB_CONNECT]: {
        type: use_wallet_1.ConnectType.WEB_CONNECT,
        name: 'Terra Station',
        icon: 'https://assets.terra.money/icon/station-extension/icon.png',
    },
};
const defaultWaitingChromeExtensionInstallCheck = 1000 * 3;
class WalletController {
    constructor(options) {
        var _a;
        this.options = options;
        this.chromeExtension = null;
        this.webConnector = null;
        this.walletConnect = null;
        this.readonlyWallet = null;
        this.disableReadonlyWallet = null;
        this.disableChromeExtension = null;
        this.disableWebExtension = null;
        this.disableWalletConnect = null;
        /** @see Wallet#isChromeExtensionCompatibleBrowser */
        this.isChromeExtensionCompatibleBrowser = () => {
            var _a;
            return ((_a = this.options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : env_1.DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK)(navigator.userAgent);
        };
        /** @see Wallet#availableConnectTypes */
        this.availableConnectTypes = () => {
            return this._availableConnectTypes.asObservable();
        };
        /** @see Wallet#availableConnections */
        this.availableConnections = () => {
            return this._availableConnectTypes.pipe((0, operators_1.map)((connectTypes) => {
                const connections = [];
                for (const connectType of connectTypes) {
                    if (connectType === use_wallet_1.ConnectType.CHROME_EXTENSION) {
                        const terraExtensions = (0, chrome_extension_1.getTerraChromeExtensions)();
                        for (const terraExtension of terraExtensions) {
                            connections.push({
                                type: use_wallet_1.ConnectType.CHROME_EXTENSION,
                                ...terraExtension,
                            });
                        }
                    }
                    else {
                        connections.push(CONNECTIONS[connectType]);
                    }
                }
                return connections;
            }));
        };
        /** @see Wallet#availableInstallTypes */
        this.availableInstallTypes = () => {
            return this._availableInstallTypes.asObservable();
        };
        /**
         * @see Wallet#status
         * @see Wallet#network
         * @see Wallet#wallets
         */
        this.states = () => {
            return this._states.asObservable();
        };
        /** @deprecated please use `states()` */
        this.status = () => {
            return this._states.pipe((0, operators_1.map)((data) => data.status));
        };
        /** @deprecated please use `states()` */
        this.network = () => {
            return this._states.pipe((0, operators_1.map)((data) => data.network));
        };
        /** @deprecated please use `states()` */
        this.wallets = () => {
            return this._states.pipe((0, operators_1.map)((data) => data.status === use_wallet_1.WalletStatus.WALLET_CONNECTED ? data.wallets : []));
        };
        /** @see Wallet#recheckStatus */
        this.recheckStatus = () => {
            var _a;
            if (this.disableChromeExtension) {
                (_a = this.chromeExtension) === null || _a === void 0 ? void 0 : _a.recheckStatus();
            }
        };
        /** @see Wallet#install */
        this.install = (type) => {
            var _a;
            if (type === use_wallet_1.ConnectType.CHROME_EXTENSION) {
                window.open(env_1.CHROME_EXTENSION_INSTALL_URL, '_blank');
            }
            else if (type === use_wallet_1.ConnectType.WEB_CONNECT) {
                const webExtensionStatus = (_a = this.webConnector) === null || _a === void 0 ? void 0 : _a.getLastStatus();
                if ((webExtensionStatus === null || webExtensionStatus === void 0 ? void 0 : webExtensionStatus.type) === web_connector_interface_1.WebConnectorStatusType.NO_AVAILABLE &&
                    webExtensionStatus.installLink) {
                    window.open(webExtensionStatus.installLink, '_blank');
                }
            }
            else {
                console.warn(`ConnectType "${type}" does not support install() function`);
            }
        };
        /** @see Wallet#connect */
        this.connect = (type, identifier) => {
            var _a, _b, _c;
            switch (type) {
                case use_wallet_1.ConnectType.READONLY:
                    const networks = Object.keys(this.options.walletConnectChainIds).map((chainId) => this.options.walletConnectChainIds[+chainId]);
                    const createReadonlyWalletSession = (_c = (_b = (_a = this.options).createReadonlyWalletSession) === null || _b === void 0 ? void 0 : _b.call(_a, networks)) !== null && _c !== void 0 ? _c : (0, readonly_wallet_modal_1.readonlyWalletModal)({ networks });
                    createReadonlyWalletSession.then((readonlyWalletSession) => {
                        if (readonlyWalletSession) {
                            this.enableReadonlyWallet((0, readonly_wallet_1.connect)(readonlyWalletSession));
                        }
                    });
                    break;
                case use_wallet_1.ConnectType.WALLETCONNECT:
                    this.enableWalletConnect((0, walletconnect_1.connect)(this.options));
                    break;
                case use_wallet_1.ConnectType.CHROME_EXTENSION:
                    this.chromeExtension.connect(identifier).then((success) => {
                        if (success) {
                            this.enableChromeExtension();
                        }
                    });
                    break;
                case use_wallet_1.ConnectType.WEB_CONNECT:
                    this.enableWebExtension();
                    break;
                default:
                    throw new Error(`Unknown ConnectType!`);
            }
        };
        /** @see Wallet#connectReadonly */
        this.connectReadonly = (terraAddress, network) => {
            this.enableReadonlyWallet((0, readonly_wallet_1.connect)({
                terraAddress,
                network,
            }));
        };
        /** @see Wallet#disconnect */
        this.disconnect = () => {
            var _a, _b, _c, _d;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            this.disableReadonlyWallet = null;
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            this.disableChromeExtension = null;
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            this.disableWebExtension = null;
            (_d = this.disableWalletConnect) === null || _d === void 0 ? void 0 : _d.call(this);
            this.disableWalletConnect = null;
            localStorage.removeItem(env_1.WEB_EXTENSION_CONNECTED_KEY);
            this.updateStates(this._notConnected);
        };
        /** @see Wallet#post */
        this.post = async (tx, 
        // TODO not work at this time. for the future extension
        txTarget = {}) => {
            // ---------------------------------------------
            // chrome extension - legacy extension
            // ---------------------------------------------
            if (this.disableChromeExtension) {
                if (!this.chromeExtension) {
                    throw new Error(`chromeExtension instance not created!`);
                }
                return (this.chromeExtension
                    // TODO make WalletConnectTxResult to common type
                    .post(tx)
                    .then(({ payload }) => {
                    return {
                        ...tx,
                        result: payload.result,
                        success: true,
                    };
                })
                    .catch((error) => {
                    if (error instanceof chrome_extension_2.ChromeExtensionCreateTxFailed) {
                        throw new wallet_types_1.CreateTxFailed(tx, error.message);
                    }
                    else if (error instanceof chrome_extension_2.ChromeExtensionTxFailed) {
                        throw new wallet_types_1.TxFailed(tx, error.txhash, error.message, null);
                    }
                    else if (error instanceof chrome_extension_2.ChromeExtensionUnspecifiedError) {
                        throw new wallet_types_1.TxUnspecifiedError(tx, error.message);
                    }
                    // UserDeniedError
                    // All unspecified errors...
                    throw error;
                }));
            }
            // ---------------------------------------------
            // web extension - new extension
            // ---------------------------------------------
            else if (this.disableWebExtension) {
                return new Promise((resolve, reject) => {
                    var _a, _b;
                    if (!this.webConnector) {
                        reject(new Error(`webExtension instance not created!`));
                        return;
                    }
                    const webExtensionStates = this.webConnector.getLastStates();
                    if (!webExtensionStates) {
                        reject(new Error(`webExtension.getLastStates() returns undefined!`));
                        return;
                    }
                    const focusedWallet = txTarget.terraAddress
                        ? (_a = webExtensionStates.wallets.find((itemWallet) => itemWallet.terraAddress === txTarget.terraAddress)) !== null && _a !== void 0 ? _a : webExtensionStates.wallets[0]
                        : webExtensionStates.focusedWalletAddress
                            ? (_b = webExtensionStates.wallets.find((itemWallet) => itemWallet.terraAddress ===
                                webExtensionStates.focusedWalletAddress)) !== null && _b !== void 0 ? _b : webExtensionStates.wallets[0]
                            : webExtensionStates.wallets[0];
                    const subscription = this.webConnector
                        .post(focusedWallet.terraAddress, tx)
                        .subscribe({
                        next: (extensionTxResult) => {
                            switch (extensionTxResult.status) {
                                case web_connector_interface_1.WebConnectorTxStatus.SUCCEED:
                                    resolve({
                                        ...tx,
                                        result: extensionTxResult.payload,
                                        success: true,
                                    });
                                    subscription.unsubscribe();
                                    break;
                            }
                        },
                        error: (error) => {
                            if (error instanceof web_connector_interface_1.WebConnectorUserDenied) {
                                reject(new wallet_types_1.UserDenied());
                            }
                            else if (error instanceof web_connector_interface_1.WebConnectorCreateTxFailed) {
                                reject(new wallet_types_1.CreateTxFailed(tx, error.message));
                            }
                            else if (error instanceof web_connector_interface_1.WebConnectorTxFailed) {
                                reject(new wallet_types_1.TxFailed(tx, error.txhash, error.message, error.raw_message));
                            }
                            else {
                                reject(new wallet_types_1.TxUnspecifiedError(tx, 'message' in error ? error.message : String(error)));
                            }
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            // ---------------------------------------------
            // wallet connect
            // ---------------------------------------------
            else if (this.walletConnect) {
                return this.walletConnect
                    .post(tx)
                    .then((result) => ({
                    ...tx,
                    result,
                    success: true,
                }))
                    .catch((error) => {
                    let throwError = error;
                    try {
                        if (error instanceof walletconnect_1.WalletConnectUserDenied) {
                            throwError = new wallet_types_1.UserDenied();
                        }
                        else if (error instanceof walletconnect_1.WalletConnectCreateTxFailed) {
                            throwError = new wallet_types_1.CreateTxFailed(tx, error.message);
                        }
                        else if (error instanceof walletconnect_1.WalletConnectTxFailed) {
                            throwError = new wallet_types_1.TxFailed(tx, error.txhash, error.message, error.raw_message);
                        }
                        else if (error instanceof walletconnect_1.WalletConnectTimeout) {
                            throwError = new wallet_types_1.Timeout(error.message);
                        }
                        else if (error instanceof walletconnect_1.WalletConnectTxUnspecifiedError) {
                            throwError = new wallet_types_1.TxUnspecifiedError(tx, error.message);
                        }
                    }
                    catch (_a) {
                        throwError = new wallet_types_1.TxUnspecifiedError(tx, 'message' in error ? error.message : String(error));
                    }
                    throw throwError;
                });
            }
            else {
                throw new Error(`There are no connections that can be posting tx!`);
            }
        };
        /** @see Wallet#sign */
        this.sign = async (tx, 
        // TODO not work at this time. for the future extension
        txTarget = {}) => {
            if (this.disableChromeExtension) {
                if (!this.chromeExtension) {
                    throw new Error(`chromeExtension instance not created!`);
                }
                return this.chromeExtension
                    .sign(tx)
                    .then(({ payload }) => {
                    const publicKey = typeof payload.result.public_key === 'string'
                        ? {
                            type: 'tendermint/PubKeySecp256k1',
                            value: payload.result.public_key,
                        }
                        : payload.result.public_key;
                    const signResult = {
                        ...payload.result,
                        public_key: publicKey,
                    };
                    return {
                        ...tx,
                        result: signResult,
                        success: true,
                    };
                })
                    .catch((error) => {
                    if (error instanceof chrome_extension_2.ChromeExtensionCreateTxFailed) {
                        throw new wallet_types_1.CreateTxFailed(tx, error.message);
                    }
                    else if (error instanceof chrome_extension_2.ChromeExtensionTxFailed) {
                        throw new wallet_types_1.TxFailed(tx, error.txhash, error.message, null);
                    }
                    else if (error instanceof chrome_extension_2.ChromeExtensionUnspecifiedError) {
                        throw new wallet_types_1.TxUnspecifiedError(tx, error.message);
                    }
                    // UserDenied - chrome extension will sent original UserDenied error type
                    // All unspecified errors...
                    throw error;
                });
            }
            throw new Error(`sign() method only available on chrome extension`);
            // TODO implements sign() to other connect types
        };
        // ================================================================
        // internal
        // connect type changing
        // ================================================================
        this.updateStates = (next) => {
            const prev = this._states.getValue();
            if (next.status === use_wallet_1.WalletStatus.WALLET_CONNECTED &&
                next.wallets.length === 0) {
                console.trace('???');
            }
            if (prev.status !== next.status || !(0, fast_deep_equal_1.default)(prev, next)) {
                this._states.next(next);
            }
        };
        this.enableReadonlyWallet = (readonlyWallet) => {
            var _a, _b, _c, _d;
            (_a = this.disableWalletConnect) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.readonlyWallet === readonlyWallet ||
                (((_d = this.readonlyWallet) === null || _d === void 0 ? void 0 : _d.terraAddress) === readonlyWallet.terraAddress &&
                    this.readonlyWallet.network === readonlyWallet.network)) {
                return;
            }
            if (this.readonlyWallet) {
                this.readonlyWallet.disconnect();
            }
            this.readonlyWallet = readonlyWallet;
            this.updateStates({
                status: use_wallet_1.WalletStatus.WALLET_CONNECTED,
                network: readonlyWallet.network,
                wallets: [
                    {
                        connectType: use_wallet_1.ConnectType.READONLY,
                        terraAddress: readonlyWallet.terraAddress,
                        design: 'readonly',
                    },
                ],
            });
            this.disableReadonlyWallet = () => {
                readonlyWallet.disconnect();
                this.readonlyWallet = null;
                this.disableReadonlyWallet = null;
            };
        };
        this.enableWebExtension = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableChromeExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.disableWebExtension || !this.webConnector) {
                return;
            }
            const extensionSubscription = (0, rxjs_1.combineLatest)([
                this.webConnector.status(),
                this.webConnector.states(),
            ]).subscribe(([status, states]) => {
                var _a;
                if (!states) {
                    return;
                }
                if (status.type === web_connector_interface_1.WebConnectorStatusType.READY) {
                    if (states.wallets.length > 0) {
                        const focusedWallet = states.focusedWalletAddress
                            ? (_a = states.wallets.find((itemWallet) => itemWallet.terraAddress === states.focusedWalletAddress)) !== null && _a !== void 0 ? _a : states.wallets[0]
                            : states.wallets[0];
                        this.updateStates({
                            status: use_wallet_1.WalletStatus.WALLET_CONNECTED,
                            network: states.network,
                            wallets: [
                                {
                                    connectType: use_wallet_1.ConnectType.WEB_CONNECT,
                                    terraAddress: focusedWallet.terraAddress,
                                    design: focusedWallet.design,
                                },
                            ],
                        });
                    }
                }
                else if (status.type === web_connector_interface_1.WebConnectorStatusType.NO_AVAILABLE) {
                    localStorage.removeItem(env_1.WEB_EXTENSION_CONNECTED_KEY);
                    this.updateStates(this._notConnected);
                    if (!status.isApproved && this.disableWebExtension) {
                        this.disableWebExtension();
                    }
                }
            });
            localStorage.setItem(env_1.WEB_EXTENSION_CONNECTED_KEY, 'true');
            const lastExtensionStatus = this.webConnector.getLastStatus();
            if (lastExtensionStatus.type === web_connector_interface_1.WebConnectorStatusType.NO_AVAILABLE &&
                lastExtensionStatus.isApproved === false) {
                this.webConnector.requestApproval();
            }
            this.disableWebExtension = () => {
                localStorage.removeItem(env_1.WEB_EXTENSION_CONNECTED_KEY);
                extensionSubscription.unsubscribe();
                this.disableWebExtension = null;
            };
        };
        this.enableChromeExtension = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.disableChromeExtension || !this.chromeExtension) {
                return;
            }
            const extensionSubscription = (0, rxjs_1.combineLatest)([
                this.chromeExtension.status(),
                this.chromeExtension.networkInfo(),
                this.chromeExtension.terraAddress(),
            ]).subscribe({
                next: ([status, networkInfo, terraAddress]) => {
                    if (status === chrome_extension_2.ChromeExtensionStatus.WALLET_CONNECTED &&
                        typeof terraAddress === 'string' &&
                        terra_js_1.AccAddress.validate(terraAddress)) {
                        this.updateStates({
                            status: use_wallet_1.WalletStatus.WALLET_CONNECTED,
                            network: networkInfo,
                            wallets: [
                                {
                                    connectType: use_wallet_1.ConnectType.CHROME_EXTENSION,
                                    terraAddress,
                                    design: 'extension',
                                },
                            ],
                        });
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                },
            });
            this.disableChromeExtension = () => {
                var _a;
                (_a = this.chromeExtension) === null || _a === void 0 ? void 0 : _a.disconnect();
                extensionSubscription.unsubscribe();
                this.disableChromeExtension = null;
            };
        };
        this.enableWalletConnect = (walletConnect) => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.walletConnect === walletConnect) {
                return;
            }
            if (this.walletConnect) {
                this.walletConnect.disconnect();
            }
            this.walletConnect = walletConnect;
            const subscribeWalletConnect = (wc) => {
                return wc.session().subscribe({
                    next: (status) => {
                        var _a;
                        switch (status.status) {
                            case walletconnect_1.WalletConnectSessionStatus.CONNECTED:
                                this.updateStates({
                                    status: use_wallet_1.WalletStatus.WALLET_CONNECTED,
                                    network: (_a = this.options.walletConnectChainIds[status.chainId]) !== null && _a !== void 0 ? _a : this.options.defaultNetwork,
                                    wallets: [
                                        {
                                            connectType: use_wallet_1.ConnectType.WALLETCONNECT,
                                            terraAddress: status.terraAddress,
                                            design: 'walletconnect',
                                        },
                                    ],
                                });
                                break;
                            default:
                                this.updateStates(this._notConnected);
                                break;
                        }
                    },
                });
            };
            const walletConnectSessionSubscription = subscribeWalletConnect(walletConnect);
            this.disableWalletConnect = () => {
                var _a;
                (_a = this.walletConnect) === null || _a === void 0 ? void 0 : _a.disconnect();
                this.walletConnect = null;
                walletConnectSessionSubscription.unsubscribe();
                this.disableWalletConnect = null;
            };
        };
        this._notConnected = {
            status: use_wallet_1.WalletStatus.WALLET_NOT_CONNECTED,
            network: options.defaultNetwork,
        };
        this._initializing = {
            status: use_wallet_1.WalletStatus.INITIALIZING,
            network: options.defaultNetwork,
        };
        this._availableConnectTypes = new rxjs_1.BehaviorSubject([
            use_wallet_1.ConnectType.READONLY,
            use_wallet_1.ConnectType.WALLETCONNECT,
        ]);
        this._availableInstallTypes = new rxjs_1.BehaviorSubject([]);
        this._states = new rxjs_1.BehaviorSubject(this._initializing);
        let numSessionCheck = 0;
        // wait checking the availability of the chrome extension
        // 0. check if extension wallet session is exists
        (0, checkAvailableExtension_1.checkAvailableExtension)((_a = options.waitingChromeExtensionInstallCheck) !== null && _a !== void 0 ? _a : defaultWaitingChromeExtensionInstallCheck, this.isChromeExtensionCompatibleBrowser()).then((extensionType) => {
            var _a;
            if (extensionType === use_wallet_1.ConnectType.WEB_CONNECT) {
                this._availableConnectTypes.next([
                    use_wallet_1.ConnectType.READONLY,
                    use_wallet_1.ConnectType.WEB_CONNECT,
                    use_wallet_1.ConnectType.WALLETCONNECT,
                ]);
                this.webConnector = new web_connector_controller_1.WebConnectorController(window);
                const subscription = this.webConnector
                    .status()
                    .pipe((0, operators_1.filter)((webExtensionStatus) => {
                    return (webExtensionStatus.type !== web_connector_interface_1.WebConnectorStatusType.INITIALIZING);
                }))
                    .subscribe((webExtensionStatus) => {
                    subscription.unsubscribe();
                    if (webExtensionStatus.type === web_connector_interface_1.WebConnectorStatusType.READY &&
                        localStorage.getItem(env_1.WEB_EXTENSION_CONNECTED_KEY) === 'true' &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableWebExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                        localStorage.removeItem(env_1.WEB_EXTENSION_CONNECTED_KEY);
                    }
                });
            }
            else if (extensionType === use_wallet_1.ConnectType.CHROME_EXTENSION) {
                this._availableConnectTypes.next([
                    use_wallet_1.ConnectType.READONLY,
                    use_wallet_1.ConnectType.CHROME_EXTENSION,
                    use_wallet_1.ConnectType.WALLETCONNECT,
                ]);
                this.chromeExtension = new chrome_extension_2.ChromeExtensionController({
                    enableWalletConnection: true,
                    defaultNetwork: options.defaultNetwork,
                    selectExtension: options.selectChromeExtension,
                    dangerously__chromeExtensionCompatibleBrowserCheck: (_a = options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : env_1.DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK,
                });
                const subscription = this.chromeExtension
                    .status()
                    .pipe((0, operators_1.filter)((chromeExtensionStatus) => {
                    return (chromeExtensionStatus !== chrome_extension_2.ChromeExtensionStatus.INITIALIZING);
                }))
                    .subscribe((chromeExtensionStatus) => {
                    try {
                        subscription.unsubscribe();
                    }
                    catch (_a) { }
                    if (chromeExtensionStatus ===
                        chrome_extension_2.ChromeExtensionStatus.WALLET_CONNECTED &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableChromeExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                });
            }
            else {
                if ((0, browser_check_1.isDesktopChrome)(this.isChromeExtensionCompatibleBrowser())) {
                    this._availableInstallTypes.next([use_wallet_1.ConnectType.CHROME_EXTENSION]);
                }
                if (numSessionCheck === 0) {
                    numSessionCheck += 1;
                }
                else {
                    this.updateStates(this._notConnected);
                }
            }
        });
        // 1. check if readonly wallet session is exists
        const draftReadonlyWallet = (0, readonly_wallet_1.connectIfSessionExists)();
        if (draftReadonlyWallet) {
            this.enableReadonlyWallet(draftReadonlyWallet);
            return;
        }
        // 2. check if walletconnect sesison is exists
        const draftWalletConnect = (0, walletconnect_1.connectIfSessionExists)(options);
        if (draftWalletConnect &&
            draftWalletConnect.getLatestSession().status ===
                walletconnect_1.WalletConnectSessionStatus.CONNECTED) {
            this.enableWalletConnect(draftWalletConnect);
        }
        else if (numSessionCheck === 0) {
            numSessionCheck += 1;
        }
        else {
            this.updateStates(this._notConnected);
        }
    }
}
exports.WalletController = WalletController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9AdGVycmEtbW9uZXkvd2FsbGV0LXByb3ZpZGVyL2NvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsNERBQTJEO0FBQzNELGtFQUdxQztBQUNyQyw0RUFBdUU7QUFDdkUsc0RBTytCO0FBQy9CLDBEQVFpQztBQUNqQyxrRkFBNkU7QUFDN0UsZ0ZBTzRDO0FBQzVDLG9EQUsrQjtBQUMvQixzRUFBd0M7QUFDeEMsK0JBQWdGO0FBQ2hGLDhDQUE2QztBQUM3QywrQkFJZTtBQUNmLGlFQU1vQztBQUNwQywrREFLbUM7QUFDbkMsMkRBWWlDO0FBQ2pDLDZFQUEwRTtBQWlGMUUsTUFBTSxXQUFXLEdBQUc7SUFDbEIsQ0FBQyx3QkFBVyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1FBQ3RCLElBQUksRUFBRSx3QkFBVyxDQUFDLFFBQVE7UUFDMUIsSUFBSSxFQUFFLGlCQUFpQjtRQUN2QixJQUFJLEVBQUUsNERBQTREO0tBQ3JEO0lBQ2YsQ0FBQyx3QkFBVyxDQUFDLGFBQWEsQ0FBQyxFQUFFO1FBQzNCLElBQUksRUFBRSx3QkFBVyxDQUFDLGFBQWE7UUFDL0IsSUFBSSxFQUFFLHNCQUFzQjtRQUM1QixJQUFJLEVBQUUsNERBQTREO0tBQ3JEO0lBQ2YsQ0FBQyx3QkFBVyxDQUFDLFdBQVcsQ0FBQyxFQUFFO1FBQ3pCLElBQUksRUFBRSx3QkFBVyxDQUFDLFdBQVc7UUFDN0IsSUFBSSxFQUFFLGVBQWU7UUFDckIsSUFBSSxFQUFFLDREQUE0RDtLQUNyRDtDQUNQLENBQUM7QUFFWCxNQUFNLHlDQUF5QyxHQUFHLElBQUksR0FBRyxDQUFDLENBQUM7QUFFM0QsTUFBYSxnQkFBZ0I7SUFrQjNCLFlBQXFCLE9BQWdDOztRQUFoQyxZQUFPLEdBQVAsT0FBTyxDQUF5QjtRQWpCN0Msb0JBQWUsR0FBcUMsSUFBSSxDQUFDO1FBQ3pELGlCQUFZLEdBQWtDLElBQUksQ0FBQztRQUNuRCxrQkFBYSxHQUFtQyxJQUFJLENBQUM7UUFDckQsbUJBQWMsR0FBb0MsSUFBSSxDQUFDO1FBTXZELDBCQUFxQixHQUF3QixJQUFJLENBQUM7UUFDbEQsMkJBQXNCLEdBQXdCLElBQUksQ0FBQztRQUNuRCx3QkFBbUIsR0FBd0IsSUFBSSxDQUFDO1FBQ2hELHlCQUFvQixHQUF3QixJQUFJLENBQUM7UUFxSnpELHFEQUFxRDtRQUNyRCx1Q0FBa0MsR0FBRyxHQUFZLEVBQUU7O1lBQ2pELE9BQU8sQ0FDTCxNQUFBLElBQUksQ0FBQyxPQUFPLENBQUMsa0RBQWtELG1DQUMvRCx1REFBaUQsQ0FDbEQsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDekIsQ0FBQyxDQUFDO1FBRUYsd0NBQXdDO1FBQ3hDLDBCQUFxQixHQUFHLEdBQThCLEVBQUU7WUFDdEQsT0FBTyxJQUFJLENBQUMsc0JBQXNCLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDcEQsQ0FBQyxDQUFDO1FBRUYsdUNBQXVDO1FBQ3ZDLHlCQUFvQixHQUFHLEdBQTZCLEVBQUU7WUFDcEQsT0FBTyxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUNyQyxJQUFBLGVBQUcsRUFBQyxDQUFDLFlBQVksRUFBRSxFQUFFO2dCQUNuQixNQUFNLFdBQVcsR0FBaUIsRUFBRSxDQUFDO2dCQUVyQyxLQUFLLE1BQU0sV0FBVyxJQUFJLFlBQVksRUFBRTtvQkFDdEMsSUFBSSxXQUFXLEtBQUssd0JBQVcsQ0FBQyxnQkFBZ0IsRUFBRTt3QkFDaEQsTUFBTSxlQUFlLEdBQUcsSUFBQSwyQ0FBd0IsR0FBRSxDQUFDO3dCQUVuRCxLQUFLLE1BQU0sY0FBYyxJQUFJLGVBQWUsRUFBRTs0QkFDNUMsV0FBVyxDQUFDLElBQUksQ0FBQztnQ0FDZixJQUFJLEVBQUUsd0JBQVcsQ0FBQyxnQkFBZ0I7Z0NBQ2xDLEdBQUcsY0FBYzs2QkFDbEIsQ0FBQyxDQUFDO3lCQUNKO3FCQUNGO3lCQUFNO3dCQUNMLFdBQVcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7cUJBQzVDO2lCQUNGO2dCQUVELE9BQU8sV0FBVyxDQUFDO1lBQ3JCLENBQUMsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDLENBQUM7UUFFRix3Q0FBd0M7UUFDeEMsMEJBQXFCLEdBQUcsR0FBOEIsRUFBRTtZQUN0RCxPQUFPLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwRCxDQUFDLENBQUM7UUFFRjs7OztXQUlHO1FBQ0gsV0FBTSxHQUFHLEdBQTZCLEVBQUU7WUFDdEMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3JDLENBQUMsQ0FBQztRQUVGLHdDQUF3QztRQUN4QyxXQUFNLEdBQUcsR0FBNkIsRUFBRTtZQUN0QyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUEsZUFBRyxFQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN2RCxDQUFDLENBQUM7UUFFRix3Q0FBd0M7UUFDeEMsWUFBTyxHQUFHLEdBQTRCLEVBQUU7WUFDdEMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFBLGVBQUcsRUFBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDO1FBRUYsd0NBQXdDO1FBQ3hDLFlBQU8sR0FBRyxHQUE2QixFQUFFO1lBQ3ZDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQ3RCLElBQUEsZUFBRyxFQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FDWCxJQUFJLENBQUMsTUFBTSxLQUFLLHlCQUFZLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FDbEUsQ0FDRixDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBRUYsZ0NBQWdDO1FBQ2hDLGtCQUFhLEdBQUcsR0FBRyxFQUFFOztZQUNuQixJQUFJLElBQUksQ0FBQyxzQkFBc0IsRUFBRTtnQkFDL0IsTUFBQSxJQUFJLENBQUMsZUFBZSwwQ0FBRSxhQUFhLEVBQUUsQ0FBQzthQUN2QztRQUNILENBQUMsQ0FBQztRQUVGLDBCQUEwQjtRQUMxQixZQUFPLEdBQUcsQ0FBQyxJQUFpQixFQUFFLEVBQUU7O1lBQzlCLElBQUksSUFBSSxLQUFLLHdCQUFXLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0NBQTRCLEVBQUUsUUFBUSxDQUFDLENBQUM7YUFDckQ7aUJBQU0sSUFBSSxJQUFJLEtBQUssd0JBQVcsQ0FBQyxXQUFXLEVBQUU7Z0JBQzNDLE1BQU0sa0JBQWtCLEdBQUcsTUFBQSxJQUFJLENBQUMsWUFBWSwwQ0FBRSxhQUFhLEVBQUUsQ0FBQztnQkFDOUQsSUFDRSxDQUFBLGtCQUFrQixhQUFsQixrQkFBa0IsdUJBQWxCLGtCQUFrQixDQUFFLElBQUksTUFBSyxnREFBc0IsQ0FBQyxZQUFZO29CQUNoRSxrQkFBa0IsQ0FBQyxXQUFXLEVBQzlCO29CQUNBLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2lCQUN2RDthQUNGO2lCQUFNO2dCQUNMLE9BQU8sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLElBQUksdUNBQXVDLENBQUMsQ0FBQzthQUMzRTtRQUNILENBQUMsQ0FBQztRQUVGLDBCQUEwQjtRQUMxQixZQUFPLEdBQUcsQ0FBQyxJQUFpQixFQUFFLFVBQW1CLEVBQUUsRUFBRTs7WUFDbkQsUUFBUSxJQUFJLEVBQUU7Z0JBQ1osS0FBSyx3QkFBVyxDQUFDLFFBQVE7b0JBQ3ZCLE1BQU0sUUFBUSxHQUFrQixNQUFNLENBQUMsSUFBSSxDQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUNuQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBRWpFLE1BQU0sMkJBQTJCLEdBQy9CLE1BQUEsTUFBQSxNQUFBLElBQUksQ0FBQyxPQUFPLEVBQUMsMkJBQTJCLG1EQUFHLFFBQVEsQ0FBQyxtQ0FDcEQsSUFBQSwyQ0FBbUIsRUFBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7b0JBRXBDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxDQUFDLHFCQUFxQixFQUFFLEVBQUU7d0JBQ3pELElBQUkscUJBQXFCLEVBQUU7NEJBQ3pCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFBLHlCQUFTLEVBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO3lCQUM3RDtvQkFDSCxDQUFDLENBQUMsQ0FBQztvQkFDSCxNQUFNO2dCQUNSLEtBQUssd0JBQVcsQ0FBQyxhQUFhO29CQUM1QixJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBQSx1QkFBUyxFQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUNsRCxNQUFNO2dCQUNSLEtBQUssd0JBQVcsQ0FBQyxnQkFBZ0I7b0JBQy9CLElBQUksQ0FBQyxlQUFnQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTt3QkFDekQsSUFBSSxPQUFPLEVBQUU7NEJBQ1gsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7eUJBQzlCO29CQUNILENBQUMsQ0FBQyxDQUFDO29CQUNILE1BQU07Z0JBQ1IsS0FBSyx3QkFBVyxDQUFDLFdBQVc7b0JBQzFCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO29CQUMxQixNQUFNO2dCQUNSO29CQUNFLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQzthQUMzQztRQUNILENBQUMsQ0FBQztRQUVGLGtDQUFrQztRQUNsQyxvQkFBZSxHQUFHLENBQUMsWUFBb0IsRUFBRSxPQUFvQixFQUFFLEVBQUU7WUFDL0QsSUFBSSxDQUFDLG9CQUFvQixDQUN2QixJQUFBLHlCQUFTLEVBQUM7Z0JBQ1IsWUFBWTtnQkFDWixPQUFPO2FBQ1IsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDLENBQUM7UUFFRiw2QkFBNkI7UUFDN0IsZUFBVSxHQUFHLEdBQUcsRUFBRTs7WUFDaEIsTUFBQSxJQUFJLENBQUMscUJBQXFCLCtDQUExQixJQUFJLENBQTBCLENBQUM7WUFDL0IsSUFBSSxDQUFDLHFCQUFxQixHQUFHLElBQUksQ0FBQztZQUVsQyxNQUFBLElBQUksQ0FBQyxzQkFBc0IsK0NBQTNCLElBQUksQ0FBMkIsQ0FBQztZQUNoQyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDO1lBRW5DLE1BQUEsSUFBSSxDQUFDLG1CQUFtQiwrQ0FBeEIsSUFBSSxDQUF3QixDQUFDO1lBQzdCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7WUFFaEMsTUFBQSxJQUFJLENBQUMsb0JBQW9CLCtDQUF6QixJQUFJLENBQXlCLENBQUM7WUFDOUIsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQztZQUVqQyxZQUFZLENBQUMsVUFBVSxDQUFDLGlDQUEyQixDQUFDLENBQUM7WUFDckQsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDO1FBRUYsdUJBQXVCO1FBQ3ZCLFNBQUksR0FBRyxLQUFLLEVBQ1YsRUFBbUI7UUFDbkIsdURBQXVEO1FBQ3ZELFdBQXNDLEVBQUUsRUFDckIsRUFBRTtZQUNyQixnREFBZ0Q7WUFDaEQsc0NBQXNDO1lBQ3RDLGdEQUFnRDtZQUNoRCxJQUFJLElBQUksQ0FBQyxzQkFBc0IsRUFBRTtnQkFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUU7b0JBQ3pCLE1BQU0sSUFBSSxLQUFLLENBQUMsdUNBQXVDLENBQUMsQ0FBQztpQkFDMUQ7Z0JBRUQsT0FBTyxDQUNMLElBQUksQ0FBQyxlQUFlO29CQUNsQixpREFBaUQ7cUJBQ2hELElBQUksQ0FBcUQsRUFBRSxDQUFDO3FCQUM1RCxJQUFJLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUU7b0JBQ3BCLE9BQU87d0JBQ0wsR0FBRyxFQUFFO3dCQUNMLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTt3QkFDdEIsT0FBTyxFQUFFLElBQUk7cUJBQ0YsQ0FBQztnQkFDaEIsQ0FBQyxDQUFDO3FCQUNELEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO29CQUNmLElBQUksS0FBSyxZQUFZLGdEQUE2QixFQUFFO3dCQUNsRCxNQUFNLElBQUksNkJBQWMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO3FCQUM3Qzt5QkFBTSxJQUFJLEtBQUssWUFBWSwwQ0FBdUIsRUFBRTt3QkFDbkQsTUFBTSxJQUFJLHVCQUFRLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztxQkFDM0Q7eUJBQU0sSUFBSSxLQUFLLFlBQVksa0RBQStCLEVBQUU7d0JBQzNELE1BQU0sSUFBSSxpQ0FBa0IsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO3FCQUNqRDtvQkFDRCxrQkFBa0I7b0JBQ2xCLDRCQUE0QjtvQkFDNUIsTUFBTSxLQUFLLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQ0wsQ0FBQzthQUNIO1lBQ0QsZ0RBQWdEO1lBQ2hELGdDQUFnQztZQUNoQyxnREFBZ0Q7aUJBQzNDLElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO2dCQUNqQyxPQUFPLElBQUksT0FBTyxDQUFXLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFOztvQkFDL0MsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7d0JBQ3RCLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDLENBQUM7d0JBQ3hELE9BQU87cUJBQ1I7b0JBRUQsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUU3RCxJQUFJLENBQUMsa0JBQWtCLEVBQUU7d0JBQ3ZCLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxpREFBaUQsQ0FBQyxDQUFDLENBQUM7d0JBQ3JFLE9BQU87cUJBQ1I7b0JBRUQsTUFBTSxhQUFhLEdBQUcsUUFBUSxDQUFDLFlBQVk7d0JBQ3pDLENBQUMsQ0FBQyxNQUFBLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQzdCLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsWUFBWSxLQUFLLFFBQVEsQ0FBQyxZQUFZLENBQ2xFLG1DQUFJLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7d0JBQ3BDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxvQkFBb0I7NEJBQ3pDLENBQUMsQ0FBQyxNQUFBLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQzdCLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FDYixVQUFVLENBQUMsWUFBWTtnQ0FDdkIsa0JBQWtCLENBQUMsb0JBQW9CLENBQzFDLG1DQUFJLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7NEJBQ3BDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBRWxDLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZO3lCQUNuQyxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUM7eUJBQ3BDLFNBQVMsQ0FBQzt3QkFDVCxJQUFJLEVBQUUsQ0FBQyxpQkFBdUMsRUFBRSxFQUFFOzRCQUNoRCxRQUFRLGlCQUFpQixDQUFDLE1BQU0sRUFBRTtnQ0FDaEMsS0FBSyw4Q0FBb0IsQ0FBQyxPQUFPO29DQUMvQixPQUFPLENBQUM7d0NBQ04sR0FBRyxFQUFFO3dDQUNMLE1BQU0sRUFBRSxpQkFBaUIsQ0FBQyxPQUFPO3dDQUNqQyxPQUFPLEVBQUUsSUFBSTtxQ0FDZCxDQUFDLENBQUM7b0NBQ0gsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO29DQUMzQixNQUFNOzZCQUNUO3dCQUNILENBQUM7d0JBQ0QsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7NEJBQ2YsSUFBSSxLQUFLLFlBQVksZ0RBQXNCLEVBQUU7Z0NBQzNDLE1BQU0sQ0FBQyxJQUFJLHlCQUFVLEVBQUUsQ0FBQyxDQUFDOzZCQUMxQjtpQ0FBTSxJQUFJLEtBQUssWUFBWSxvREFBMEIsRUFBRTtnQ0FDdEQsTUFBTSxDQUFDLElBQUksNkJBQWMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7NkJBQy9DO2lDQUFNLElBQUksS0FBSyxZQUFZLDhDQUFvQixFQUFFO2dDQUNoRCxNQUFNLENBQ0osSUFBSSx1QkFBUSxDQUNWLEVBQUUsRUFDRixLQUFLLENBQUMsTUFBTSxFQUNaLEtBQUssQ0FBQyxPQUFPLEVBQ2IsS0FBSyxDQUFDLFdBQVcsQ0FDbEIsQ0FDRixDQUFDOzZCQUNIO2lDQUFNO2dDQUNMLE1BQU0sQ0FDSixJQUFJLGlDQUFrQixDQUNwQixFQUFFLEVBQ0YsU0FBUyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUNuRCxDQUNGLENBQUM7NkJBQ0g7NEJBQ0QsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO3dCQUM3QixDQUFDO3FCQUNGLENBQUMsQ0FBQztnQkFDUCxDQUFDLENBQUMsQ0FBQzthQUNKO1lBQ0QsZ0RBQWdEO1lBQ2hELGlCQUFpQjtZQUNqQixnREFBZ0Q7aUJBQzNDLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtnQkFDM0IsT0FBTyxJQUFJLENBQUMsYUFBYTtxQkFDdEIsSUFBSSxDQUFDLEVBQUUsQ0FBQztxQkFDUixJQUFJLENBQ0gsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUNULENBQUM7b0JBQ0MsR0FBRyxFQUFFO29CQUNMLE1BQU07b0JBQ04sT0FBTyxFQUFFLElBQUk7aUJBQ0QsQ0FBQSxDQUNqQjtxQkFDQSxLQUFLLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtvQkFDZixJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUM7b0JBRXZCLElBQUk7d0JBQ0YsSUFBSSxLQUFLLFlBQVksdUNBQXVCLEVBQUU7NEJBQzVDLFVBQVUsR0FBRyxJQUFJLHlCQUFVLEVBQUUsQ0FBQzt5QkFDL0I7NkJBQU0sSUFBSSxLQUFLLFlBQVksMkNBQTJCLEVBQUU7NEJBQ3ZELFVBQVUsR0FBRyxJQUFJLDZCQUFjLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQzt5QkFDcEQ7NkJBQU0sSUFBSSxLQUFLLFlBQVkscUNBQXFCLEVBQUU7NEJBQ2pELFVBQVUsR0FBRyxJQUFJLHVCQUFRLENBQ3ZCLEVBQUUsRUFDRixLQUFLLENBQUMsTUFBTSxFQUNaLEtBQUssQ0FBQyxPQUFPLEVBQ2IsS0FBSyxDQUFDLFdBQVcsQ0FDbEIsQ0FBQzt5QkFDSDs2QkFBTSxJQUFJLEtBQUssWUFBWSxvQ0FBb0IsRUFBRTs0QkFDaEQsVUFBVSxHQUFHLElBQUksc0JBQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7eUJBQ3pDOzZCQUFNLElBQUksS0FBSyxZQUFZLCtDQUErQixFQUFFOzRCQUMzRCxVQUFVLEdBQUcsSUFBSSxpQ0FBa0IsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO3lCQUN4RDtxQkFDRjtvQkFBQyxXQUFNO3dCQUNOLFVBQVUsR0FBRyxJQUFJLGlDQUFrQixDQUNqQyxFQUFFLEVBQ0YsU0FBUyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUNuRCxDQUFDO3FCQUNIO29CQUVELE1BQU0sVUFBVSxDQUFDO2dCQUNuQixDQUFDLENBQUMsQ0FBQzthQUNOO2lCQUFNO2dCQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMsa0RBQWtELENBQUMsQ0FBQzthQUNyRTtRQUNILENBQUMsQ0FBQztRQUVGLHVCQUF1QjtRQUN2QixTQUFJLEdBQUcsS0FBSyxFQUNWLEVBQW1CO1FBQ25CLHVEQUF1RDtRQUN2RCxXQUFzQyxFQUFFLEVBQ25CLEVBQUU7WUFXdkIsSUFBSSxJQUFJLENBQUMsc0JBQXNCLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFO29CQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxDQUFDLENBQUM7aUJBQzFEO2dCQUVELE9BQU8sSUFBSSxDQUFDLGVBQWU7cUJBQ3hCLElBQUksQ0FBaUMsRUFBRSxDQUFDO3FCQUN4QyxJQUFJLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUU7b0JBQ3BCLE1BQU0sU0FBUyxHQUNiLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEtBQUssUUFBUTt3QkFDM0MsQ0FBQyxDQUFDOzRCQUNFLElBQUksRUFBRSw0QkFBNEI7NEJBQ2xDLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQVU7eUJBQ2pDO3dCQUNILENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztvQkFFaEMsTUFBTSxVQUFVLEdBQXlCO3dCQUN2QyxHQUFHLE9BQU8sQ0FBQyxNQUFNO3dCQUNqQixVQUFVLEVBQUUsU0FBUztxQkFDdEIsQ0FBQztvQkFFRixPQUFPO3dCQUNMLEdBQUcsRUFBRTt3QkFDTCxNQUFNLEVBQUUsVUFBVTt3QkFDbEIsT0FBTyxFQUFFLElBQUk7cUJBQ2QsQ0FBQztnQkFDSixDQUFDLENBQUM7cUJBQ0QsS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7b0JBQ2YsSUFBSSxLQUFLLFlBQVksZ0RBQTZCLEVBQUU7d0JBQ2xELE1BQU0sSUFBSSw2QkFBYyxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7cUJBQzdDO3lCQUFNLElBQUksS0FBSyxZQUFZLDBDQUF1QixFQUFFO3dCQUNuRCxNQUFNLElBQUksdUJBQVEsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO3FCQUMzRDt5QkFBTSxJQUFJLEtBQUssWUFBWSxrREFBK0IsRUFBRTt3QkFDM0QsTUFBTSxJQUFJLGlDQUFrQixDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7cUJBQ2pEO29CQUNELHlFQUF5RTtvQkFDekUsNEJBQTRCO29CQUM1QixNQUFNLEtBQUssQ0FBQztnQkFDZCxDQUFDLENBQUMsQ0FBQzthQUNOO1lBRUQsTUFBTSxJQUFJLEtBQUssQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1lBQ3BFLGdEQUFnRDtRQUNsRCxDQUFDLENBQUM7UUFFRixtRUFBbUU7UUFDbkUsV0FBVztRQUNYLHdCQUF3QjtRQUN4QixtRUFBbUU7UUFDM0QsaUJBQVksR0FBRyxDQUFDLElBQWtCLEVBQUUsRUFBRTtZQUM1QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRXJDLElBQ0UsSUFBSSxDQUFDLE1BQU0sS0FBSyx5QkFBWSxDQUFDLGdCQUFnQjtnQkFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUN6QjtnQkFDQSxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ3RCO1lBRUQsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxJQUFBLHlCQUFTLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFO2dCQUN6RCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN6QjtRQUNILENBQUMsQ0FBQztRQUVNLHlCQUFvQixHQUFHLENBQUMsY0FBd0MsRUFBRSxFQUFFOztZQUMxRSxNQUFBLElBQUksQ0FBQyxvQkFBb0IsK0NBQXpCLElBQUksQ0FBeUIsQ0FBQztZQUM5QixNQUFBLElBQUksQ0FBQyxzQkFBc0IsK0NBQTNCLElBQUksQ0FBMkIsQ0FBQztZQUNoQyxNQUFBLElBQUksQ0FBQyxtQkFBbUIsK0NBQXhCLElBQUksQ0FBd0IsQ0FBQztZQUU3QixJQUNFLElBQUksQ0FBQyxjQUFjLEtBQUssY0FBYztnQkFDdEMsQ0FBQyxDQUFBLE1BQUEsSUFBSSxDQUFDLGNBQWMsMENBQUUsWUFBWSxNQUFLLGNBQWMsQ0FBQyxZQUFZO29CQUNoRSxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sS0FBSyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQ3pEO2dCQUNBLE9BQU87YUFDUjtZQUVELElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtnQkFDdkIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQzthQUNsQztZQUVELElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO1lBRXJDLElBQUksQ0FBQyxZQUFZLENBQUM7Z0JBQ2hCLE1BQU0sRUFBRSx5QkFBWSxDQUFDLGdCQUFnQjtnQkFDckMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxPQUFPO2dCQUMvQixPQUFPLEVBQUU7b0JBQ1A7d0JBQ0UsV0FBVyxFQUFFLHdCQUFXLENBQUMsUUFBUTt3QkFDakMsWUFBWSxFQUFFLGNBQWMsQ0FBQyxZQUFZO3dCQUN6QyxNQUFNLEVBQUUsVUFBVTtxQkFDbkI7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMscUJBQXFCLEdBQUcsR0FBRyxFQUFFO2dCQUNoQyxjQUFjLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO2dCQUMzQixJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDO1lBQ3BDLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQztRQUVNLHVCQUFrQixHQUFHLEdBQUcsRUFBRTs7WUFDaEMsTUFBQSxJQUFJLENBQUMscUJBQXFCLCtDQUExQixJQUFJLENBQTBCLENBQUM7WUFDL0IsTUFBQSxJQUFJLENBQUMsb0JBQW9CLCtDQUF6QixJQUFJLENBQXlCLENBQUM7WUFDOUIsTUFBQSxJQUFJLENBQUMsc0JBQXNCLCtDQUEzQixJQUFJLENBQTJCLENBQUM7WUFFaEMsSUFBSSxJQUFJLENBQUMsbUJBQW1CLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNsRCxPQUFPO2FBQ1I7WUFFRCxNQUFNLHFCQUFxQixHQUFHLElBQUEsb0JBQWEsRUFBQztnQkFDMUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUU7Z0JBQzFCLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFO2FBQzNCLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFOztnQkFDaEMsSUFBSSxDQUFDLE1BQU0sRUFBRTtvQkFDWCxPQUFPO2lCQUNSO2dCQUVELElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxnREFBc0IsQ0FBQyxLQUFLLEVBQUU7b0JBQ2hELElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO3dCQUM3QixNQUFNLGFBQWEsR0FBRyxNQUFNLENBQUMsb0JBQW9COzRCQUMvQyxDQUFDLENBQUMsTUFBQSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FDakIsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUNiLFVBQVUsQ0FBQyxZQUFZLEtBQUssTUFBTSxDQUFDLG9CQUFvQixDQUMxRCxtQ0FBSSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQzs0QkFDeEIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBRXRCLElBQUksQ0FBQyxZQUFZLENBQUM7NEJBQ2hCLE1BQU0sRUFBRSx5QkFBWSxDQUFDLGdCQUFnQjs0QkFDckMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxPQUFPOzRCQUN2QixPQUFPLEVBQUU7Z0NBQ1A7b0NBQ0UsV0FBVyxFQUFFLHdCQUFXLENBQUMsV0FBVztvQ0FDcEMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxZQUFZO29DQUN4QyxNQUFNLEVBQUUsYUFBYSxDQUFDLE1BQU07aUNBQzdCOzZCQUNGO3lCQUNGLENBQUMsQ0FBQztxQkFDSjtpQkFDRjtxQkFBTSxJQUFJLE1BQU0sQ0FBQyxJQUFJLEtBQUssZ0RBQXNCLENBQUMsWUFBWSxFQUFFO29CQUM5RCxZQUFZLENBQUMsVUFBVSxDQUFDLGlDQUEyQixDQUFDLENBQUM7b0JBQ3JELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO29CQUV0QyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUU7d0JBQ2xELElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO3FCQUM1QjtpQkFDRjtZQUNILENBQUMsQ0FBQyxDQUFDO1lBRUgsWUFBWSxDQUFDLE9BQU8sQ0FBQyxpQ0FBMkIsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUUxRCxNQUFNLG1CQUFtQixHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFOUQsSUFDRSxtQkFBbUIsQ0FBQyxJQUFJLEtBQUssZ0RBQXNCLENBQUMsWUFBWTtnQkFDaEUsbUJBQW1CLENBQUMsVUFBVSxLQUFLLEtBQUssRUFDeEM7Z0JBQ0EsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsQ0FBQzthQUNyQztZQUVELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxHQUFHLEVBQUU7Z0JBQzlCLFlBQVksQ0FBQyxVQUFVLENBQUMsaUNBQTJCLENBQUMsQ0FBQztnQkFDckQscUJBQXFCLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7WUFDbEMsQ0FBQyxDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBRU0sMEJBQXFCLEdBQUcsR0FBRyxFQUFFOztZQUNuQyxNQUFBLElBQUksQ0FBQyxxQkFBcUIsK0NBQTFCLElBQUksQ0FBMEIsQ0FBQztZQUMvQixNQUFBLElBQUksQ0FBQyxvQkFBb0IsK0NBQXpCLElBQUksQ0FBeUIsQ0FBQztZQUM5QixNQUFBLElBQUksQ0FBQyxtQkFBbUIsK0NBQXhCLElBQUksQ0FBd0IsQ0FBQztZQUU3QixJQUFJLElBQUksQ0FBQyxzQkFBc0IsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3hELE9BQU87YUFDUjtZQUVELE1BQU0scUJBQXFCLEdBQUcsSUFBQSxvQkFBYSxFQUFDO2dCQUMxQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRTtnQkFDN0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUU7Z0JBQ2xDLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUFFO2FBQ3BDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLFlBQVksQ0FBQyxFQUFFLEVBQUU7b0JBQzVDLElBQ0UsTUFBTSxLQUFLLHdDQUFxQixDQUFDLGdCQUFnQjt3QkFDakQsT0FBTyxZQUFZLEtBQUssUUFBUTt3QkFDaEMscUJBQVUsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQ2pDO3dCQUNBLElBQUksQ0FBQyxZQUFZLENBQUM7NEJBQ2hCLE1BQU0sRUFBRSx5QkFBWSxDQUFDLGdCQUFnQjs0QkFDckMsT0FBTyxFQUFFLFdBQVc7NEJBQ3BCLE9BQU8sRUFBRTtnQ0FDUDtvQ0FDRSxXQUFXLEVBQUUsd0JBQVcsQ0FBQyxnQkFBZ0I7b0NBQ3pDLFlBQVk7b0NBQ1osTUFBTSxFQUFFLFdBQVc7aUNBQ3BCOzZCQUNGO3lCQUNGLENBQUMsQ0FBQztxQkFDSjt5QkFBTTt3QkFDTCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztxQkFDdkM7Z0JBQ0gsQ0FBQzthQUNGLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxzQkFBc0IsR0FBRyxHQUFHLEVBQUU7O2dCQUNqQyxNQUFBLElBQUksQ0FBQyxlQUFlLDBDQUFFLFVBQVUsRUFBRSxDQUFDO2dCQUNuQyxxQkFBcUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLHNCQUFzQixHQUFHLElBQUksQ0FBQztZQUNyQyxDQUFDLENBQUM7UUFDSixDQUFDLENBQUM7UUFFTSx3QkFBbUIsR0FBRyxDQUFDLGFBQXNDLEVBQUUsRUFBRTs7WUFDdkUsTUFBQSxJQUFJLENBQUMscUJBQXFCLCtDQUExQixJQUFJLENBQTBCLENBQUM7WUFDL0IsTUFBQSxJQUFJLENBQUMsc0JBQXNCLCtDQUEzQixJQUFJLENBQTJCLENBQUM7WUFDaEMsTUFBQSxJQUFJLENBQUMsbUJBQW1CLCtDQUF4QixJQUFJLENBQXdCLENBQUM7WUFFN0IsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLGFBQWEsRUFBRTtnQkFDeEMsT0FBTzthQUNSO1lBRUQsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN0QixJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRSxDQUFDO2FBQ2pDO1lBRUQsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7WUFFbkMsTUFBTSxzQkFBc0IsR0FBRyxDQUM3QixFQUEyQixFQUNiLEVBQUU7Z0JBQ2hCLE9BQU8sRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDNUIsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUU7O3dCQUNmLFFBQVEsTUFBTSxDQUFDLE1BQU0sRUFBRTs0QkFDckIsS0FBSywwQ0FBMEIsQ0FBQyxTQUFTO2dDQUN2QyxJQUFJLENBQUMsWUFBWSxDQUFDO29DQUNoQixNQUFNLEVBQUUseUJBQVksQ0FBQyxnQkFBZ0I7b0NBQ3JDLE9BQU8sRUFDTCxNQUFBLElBQUksQ0FBQyxPQUFPLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxtQ0FDbEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjO29DQUM3QixPQUFPLEVBQUU7d0NBQ1A7NENBQ0UsV0FBVyxFQUFFLHdCQUFXLENBQUMsYUFBYTs0Q0FDdEMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxZQUFZOzRDQUNqQyxNQUFNLEVBQUUsZUFBZTt5Q0FDeEI7cUNBQ0Y7aUNBQ0YsQ0FBQyxDQUFDO2dDQUNILE1BQU07NEJBQ1I7Z0NBQ0UsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7Z0NBQ3RDLE1BQU07eUJBQ1Q7b0JBQ0gsQ0FBQztpQkFDRixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUM7WUFFRixNQUFNLGdDQUFnQyxHQUNwQyxzQkFBc0IsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUV4QyxJQUFJLENBQUMsb0JBQW9CLEdBQUcsR0FBRyxFQUFFOztnQkFDL0IsTUFBQSxJQUFJLENBQUMsYUFBYSwwQ0FBRSxVQUFVLEVBQUUsQ0FBQztnQkFDakMsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7Z0JBQzFCLGdDQUFnQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUMvQyxJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDO1lBQ25DLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQztRQXR1QkEsSUFBSSxDQUFDLGFBQWEsR0FBRztZQUNuQixNQUFNLEVBQUUseUJBQVksQ0FBQyxvQkFBb0I7WUFDekMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxjQUFjO1NBQ2hDLENBQUM7UUFFRixJQUFJLENBQUMsYUFBYSxHQUFHO1lBQ25CLE1BQU0sRUFBRSx5QkFBWSxDQUFDLFlBQVk7WUFDakMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxjQUFjO1NBQ2hDLENBQUM7UUFFRixJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxzQkFBZSxDQUFnQjtZQUMvRCx3QkFBVyxDQUFDLFFBQVE7WUFDcEIsd0JBQVcsQ0FBQyxhQUFhO1NBQzFCLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLHNCQUFlLENBQWdCLEVBQUUsQ0FBQyxDQUFDO1FBRXJFLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxzQkFBZSxDQUFlLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUVyRSxJQUFJLGVBQWUsR0FBVyxDQUFDLENBQUM7UUFFaEMseURBQXlEO1FBQ3pELGlEQUFpRDtRQUNqRCxJQUFBLGlEQUF1QixFQUNyQixNQUFBLE9BQU8sQ0FBQyxrQ0FBa0MsbUNBQ3hDLHlDQUF5QyxFQUMzQyxJQUFJLENBQUMsa0NBQWtDLEVBQUUsQ0FDMUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxhQUFhLEVBQUUsRUFBRTs7WUFDdkIsSUFBSSxhQUFhLEtBQUssd0JBQVcsQ0FBQyxXQUFXLEVBQUU7Z0JBQzdDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUM7b0JBQy9CLHdCQUFXLENBQUMsUUFBUTtvQkFDcEIsd0JBQVcsQ0FBQyxXQUFXO29CQUN2Qix3QkFBVyxDQUFDLGFBQWE7aUJBQzFCLENBQUMsQ0FBQztnQkFFSCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksaURBQXNCLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBRXZELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZO3FCQUNuQyxNQUFNLEVBQUU7cUJBQ1IsSUFBSSxDQUNILElBQUEsa0JBQU0sRUFBQyxDQUFDLGtCQUFrQixFQUFFLEVBQUU7b0JBQzVCLE9BQU8sQ0FDTCxrQkFBa0IsQ0FBQyxJQUFJLEtBQUssZ0RBQXNCLENBQUMsWUFBWSxDQUNoRSxDQUFDO2dCQUNKLENBQUMsQ0FBQyxDQUNIO3FCQUNBLFNBQVMsQ0FBQyxDQUFDLGtCQUFrQixFQUFFLEVBQUU7b0JBQ2hDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFFM0IsSUFDRSxrQkFBa0IsQ0FBQyxJQUFJLEtBQUssZ0RBQXNCLENBQUMsS0FBSzt3QkFDeEQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxpQ0FBMkIsQ0FBQyxLQUFLLE1BQU07d0JBQzVELENBQUMsSUFBSSxDQUFDLG9CQUFvQjt3QkFDMUIsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQzNCO3dCQUNBLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO3FCQUMzQjt5QkFBTSxJQUFJLGVBQWUsS0FBSyxDQUFDLEVBQUU7d0JBQ2hDLGVBQWUsSUFBSSxDQUFDLENBQUM7cUJBQ3RCO3lCQUFNO3dCQUNMLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO3dCQUN0QyxZQUFZLENBQUMsVUFBVSxDQUFDLGlDQUEyQixDQUFDLENBQUM7cUJBQ3REO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ047aUJBQU0sSUFBSSxhQUFhLEtBQUssd0JBQVcsQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDekQsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQztvQkFDL0Isd0JBQVcsQ0FBQyxRQUFRO29CQUNwQix3QkFBVyxDQUFDLGdCQUFnQjtvQkFDNUIsd0JBQVcsQ0FBQyxhQUFhO2lCQUMxQixDQUFDLENBQUM7Z0JBRUgsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLDRDQUF5QixDQUFDO29CQUNuRCxzQkFBc0IsRUFBRSxJQUFJO29CQUM1QixjQUFjLEVBQUUsT0FBTyxDQUFDLGNBQWM7b0JBQ3RDLGVBQWUsRUFBRSxPQUFPLENBQUMscUJBQXFCO29CQUM5QyxrREFBa0QsRUFDaEQsTUFBQSxPQUFPLENBQUMsa0RBQWtELG1DQUMxRCx1REFBaUQ7aUJBQ3BELENBQUMsQ0FBQztnQkFFSCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsZUFBZTtxQkFDdEMsTUFBTSxFQUFFO3FCQUNSLElBQUksQ0FDSCxJQUFBLGtCQUFNLEVBQUMsQ0FBQyxxQkFBcUIsRUFBRSxFQUFFO29CQUMvQixPQUFPLENBQ0wscUJBQXFCLEtBQUssd0NBQXFCLENBQUMsWUFBWSxDQUM3RCxDQUFDO2dCQUNKLENBQUMsQ0FBQyxDQUNIO3FCQUNBLFNBQVMsQ0FBQyxDQUFDLHFCQUFxQixFQUFFLEVBQUU7b0JBQ25DLElBQUk7d0JBQ0YsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO3FCQUM1QjtvQkFBQyxXQUFNLEdBQUU7b0JBRVYsSUFDRSxxQkFBcUI7d0JBQ25CLHdDQUFxQixDQUFDLGdCQUFnQjt3QkFDeEMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CO3dCQUMxQixDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFDM0I7d0JBQ0EsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7cUJBQzlCO3lCQUFNLElBQUksZUFBZSxLQUFLLENBQUMsRUFBRTt3QkFDaEMsZUFBZSxJQUFJLENBQUMsQ0FBQztxQkFDdEI7eUJBQU07d0JBQ0wsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7cUJBQ3ZDO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ047aUJBQU07Z0JBQ0wsSUFBSSxJQUFBLCtCQUFlLEVBQUMsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLENBQUMsRUFBRTtvQkFDOUQsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxDQUFDLHdCQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO2lCQUNsRTtnQkFFRCxJQUFJLGVBQWUsS0FBSyxDQUFDLEVBQUU7b0JBQ3pCLGVBQWUsSUFBSSxDQUFDLENBQUM7aUJBQ3RCO3FCQUFNO29CQUNMLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO2lCQUN2QzthQUNGO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxnREFBZ0Q7UUFDaEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFBLHdDQUF3QixHQUFFLENBQUM7UUFFdkQsSUFBSSxtQkFBbUIsRUFBRTtZQUN2QixJQUFJLENBQUMsb0JBQW9CLENBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUMvQyxPQUFPO1NBQ1I7UUFFRCw4Q0FBOEM7UUFDOUMsTUFBTSxrQkFBa0IsR0FBRyxJQUFBLHNDQUF3QixFQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTdELElBQ0Usa0JBQWtCO1lBQ2xCLGtCQUFrQixDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTTtnQkFDMUMsMENBQTBCLENBQUMsU0FBUyxFQUN0QztZQUNBLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQzlDO2FBQU0sSUFBSSxlQUFlLEtBQUssQ0FBQyxFQUFFO1lBQ2hDLGVBQWUsSUFBSSxDQUFDLENBQUM7U0FDdEI7YUFBTTtZQUNMLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3ZDO0lBQ0gsQ0FBQztDQTBsQkY7QUExdkJELDRDQTB2QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc0Rlc2t0b3BDaHJvbWUgfSBmcm9tICdAdGVycmEtZGV2L2Jyb3dzZXItY2hlY2snO1xuaW1wb3J0IHtcbiAgQ2hyb21lRXh0ZW5zaW9uSW5mbyxcbiAgZ2V0VGVycmFDaHJvbWVFeHRlbnNpb25zLFxufSBmcm9tICdAdGVycmEtZGV2L2Nocm9tZS1leHRlbnNpb24nO1xuaW1wb3J0IHsgcmVhZG9ubHlXYWxsZXRNb2RhbCB9IGZyb20gJ0B0ZXJyYS1kZXYvcmVhZG9ubHktd2FsbGV0LW1vZGFsJztcbmltcG9ydCB7XG4gIENvbm5lY3Rpb24sXG4gIENvbm5lY3RUeXBlLFxuICBUeFJlc3VsdCxcbiAgV2FsbGV0SW5mbyxcbiAgV2FsbGV0U3RhdGVzLFxuICBXYWxsZXRTdGF0dXMsXG59IGZyb20gJ0B0ZXJyYS1kZXYvdXNlLXdhbGxldCc7XG5pbXBvcnQge1xuICBDcmVhdGVUeEZhaWxlZCxcbiAgTmV0d29ya0luZm8sXG4gIFNpZ25SZXN1bHQsXG4gIFRpbWVvdXQsXG4gIFR4RmFpbGVkLFxuICBUeFVuc3BlY2lmaWVkRXJyb3IsXG4gIFVzZXJEZW5pZWQsXG59IGZyb20gJ0B0ZXJyYS1kZXYvd2FsbGV0LXR5cGVzJztcbmltcG9ydCB7IFdlYkNvbm5lY3RvckNvbnRyb2xsZXIgfSBmcm9tICdAdGVycmEtZGV2L3dlYi1jb25uZWN0b3ItY29udHJvbGxlcic7XG5pbXBvcnQge1xuICBXZWJDb25uZWN0b3JDcmVhdGVUeEZhaWxlZCxcbiAgV2ViQ29ubmVjdG9yU3RhdHVzVHlwZSxcbiAgV2ViQ29ubmVjdG9yVHhGYWlsZWQsXG4gIFdlYkNvbm5lY3RvclR4UmVzdWx0LFxuICBXZWJDb25uZWN0b3JUeFN0YXR1cyxcbiAgV2ViQ29ubmVjdG9yVXNlckRlbmllZCxcbn0gZnJvbSAnQHRlcnJhLWRldi93ZWItY29ubmVjdG9yLWludGVyZmFjZSc7XG5pbXBvcnQge1xuICBBY2NBZGRyZXNzLFxuICBDcmVhdGVUeE9wdGlvbnMsXG4gIFB1YmxpY0tleSxcbiAgU3RkU2lnbk1zZyxcbn0gZnJvbSAnQHRlcnJhLW1vbmV5L3RlcnJhLmpzJztcbmltcG9ydCBkZWVwRXF1YWwgZnJvbSAnZmFzdC1kZWVwLWVxdWFsJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgY29tYmluZUxhdGVzdCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIENIUk9NRV9FWFRFTlNJT05fSU5TVEFMTF9VUkwsXG4gIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0ssXG4gIFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSxcbn0gZnJvbSAnLi9lbnYnO1xuaW1wb3J0IHtcbiAgQ2hyb21lRXh0ZW5zaW9uQ29udHJvbGxlcixcbiAgQ2hyb21lRXh0ZW5zaW9uQ3JlYXRlVHhGYWlsZWQsXG4gIENocm9tZUV4dGVuc2lvblN0YXR1cyxcbiAgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQsXG4gIENocm9tZUV4dGVuc2lvblVuc3BlY2lmaWVkRXJyb3IsXG59IGZyb20gJy4vbW9kdWxlcy9jaHJvbWUtZXh0ZW5zaW9uJztcbmltcG9ydCB7XG4gIGNvbm5lY3QgYXMgcmVDb25uZWN0LFxuICBjb25uZWN0SWZTZXNzaW9uRXhpc3RzIGFzIHJlQ29ubmVjdElmU2Vzc2lvbkV4aXN0cyxcbiAgUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyLFxuICBSZWFkb25seVdhbGxldFNlc3Npb24sXG59IGZyb20gJy4vbW9kdWxlcy9yZWFkb25seS13YWxsZXQnO1xuaW1wb3J0IHtcbiAgY29ubmVjdCBhcyB3Y0Nvbm5lY3QsXG4gIGNvbm5lY3RJZlNlc3Npb25FeGlzdHMgYXMgd2NDb25uZWN0SWZTZXNzaW9uRXhpc3RzLFxuICBXYWxsZXRDb25uZWN0Q29udHJvbGxlcixcbiAgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zLFxuICBXYWxsZXRDb25uZWN0Q3JlYXRlVHhGYWlsZWQsXG4gIFdhbGxldENvbm5lY3RTZXNzaW9uU3RhdHVzLFxuICBXYWxsZXRDb25uZWN0VGltZW91dCxcbiAgV2FsbGV0Q29ubmVjdFR4RmFpbGVkLFxuICBXYWxsZXRDb25uZWN0VHhSZXN1bHQsXG4gIFdhbGxldENvbm5lY3RUeFVuc3BlY2lmaWVkRXJyb3IsXG4gIFdhbGxldENvbm5lY3RVc2VyRGVuaWVkLFxufSBmcm9tICcuL21vZHVsZXMvd2FsbGV0Y29ubmVjdCc7XG5pbXBvcnQgeyBjaGVja0F2YWlsYWJsZUV4dGVuc2lvbiB9IGZyb20gJy4vdXRpbHMvY2hlY2tBdmFpbGFibGVFeHRlbnNpb24nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdhbGxldENvbnRyb2xsZXJPcHRpb25zXG4gIGV4dGVuZHMgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zIHtcbiAgLyoqXG4gICAqIOKaoO+4jyBEb24ndCBoYXJkY29kaW5nIHRoaXMsIHVzZSBnZXRDaGFpbiBPcHRpb25zKClcbiAgICpcbiAgICogZmFsbGJhY2sgbmV0d29yayBpZiBjb250cm9sbGVyIGlzIG5vdCBjb25uZWN0ZWRcbiAgICovXG4gIGRlZmF1bHROZXR3b3JrOiBOZXR3b3JrSW5mbztcblxuICAvKipcbiAgICog4pqg77iPIERvbid0IGhhcmRjb2RpbmcgdGhpcywgdXNlIGdldENoYWluIE9wdGlvbnMoKVxuICAgKlxuICAgKiBmb3Igd2FsbGV0Y29ubmVjdFxuICAgKlxuICAgKiBUaGUgbmV0d29yayBydWxlcyBwYXNzZWQgYnkgdGhlIFRlcnJhIFN0YXRpb24gTW9iaWxlIGFyZSAwIGlzIHRlc3RuZXQsIDEgaXMgbWFpbm5ldC5cbiAgICpcbiAgICogQWx3YXlzIHNldCB0ZXN0bmV0IGZvciAwIGFuZCBtYWlubmV0IGZvciAxLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBcbiAgICogY29uc3QgbWFpbm5ldDogTmV0d29ya0luZm8gPSB7XG4gICAqICBuYW1lOiAnbWFpbm5ldCcsXG4gICAqICBjaGFpbklEOiAnY29sdW1idXMtNScsXG4gICAqICBsY2Q6ICdodHRwczovL2xjZC50ZXJyYS5kZXYnLFxuICAgKiB9XG4gICAqXG4gICAqIGNvbnN0IHRlc3RuZXQ6IE5ldHdvcmtJbmZvID0ge1xuICAgKiAgbmFtZTogJ3Rlc3RuZXQnLFxuICAgKiAgY2hhaW5JRDogJ2JvbWJheS0xMicsXG4gICAqICBsY2Q6ICdodHRwczovL2JvbWJheS1sY2QudGVycmEuZGV2JyxcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPiA9IHtcbiAgICogICAwOiB0ZXN0bmV0LFxuICAgKiAgIDE6IG1haW5uZXQsXG4gICAqIH1cbiAgICpcbiAgICogPFdhbGxldFByb3ZpZGVyIHdhbGxldENvbm5lY3RDaGFpbklkcz17d2FsbGV0Q29ubmVjdENoYWluSWRzfT5cbiAgICogYGBgXG4gICAqL1xuICB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPjtcblxuICAvKipcbiAgICogcnVuIGF0IGV4ZWN1dGluZyB0aGUgYGNvbm5lY3QoQ29ubmVjdFR5cGUuUkVBRE9OTFkpYFxuICAgKi9cbiAgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uPzogKFxuICAgIG5ldHdvcmtzOiBOZXR3b3JrSW5mb1tdLFxuICApID0+IFByb21pc2U8UmVhZG9ubHlXYWxsZXRTZXNzaW9uIHwgbnVsbD47XG5cbiAgLyoqXG4gICAqIHJ1biBhdCBleGVjdXRpbmcgdGhlIGBjb25uZWN0KENvbm5lY3RUeXBlLkNIUk9NRV9FWFRFTlNJT04pYFxuICAgKiBpZiB1c2VyIGluc3RhbGxlZCBtdWx0aXBsZSB3YWxsZXRzXG4gICAqL1xuICBzZWxlY3RDaHJvbWVFeHRlbnNpb24/OiAoXG4gICAgZXh0ZW5zaW9uSW5mb3M6IENocm9tZUV4dGVuc2lvbkluZm9bXSxcbiAgKSA9PiBQcm9taXNlPENocm9tZUV4dGVuc2lvbkluZm8gfCBudWxsPjtcblxuICAvKipcbiAgICogbWlsbGlzZWNvbmRzIHRvIHdhaXQgY2hlY2tpbmcgY2hyb21lIGV4dGVuc2lvbiBpcyBpbnN0YWxsZWRcbiAgICpcbiAgICogQGRlZmF1bHQgMTAwMCAqIDMgbWlsaXNlY29uZHNcbiAgICovXG4gIHdhaXRpbmdDaHJvbWVFeHRlbnNpb25JbnN0YWxsQ2hlY2s/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIOKaoO+4jyBUaGlzIEFQSSBpcyBhbiBvcHRpb24gZm9yIHdhbGxldCBkZXZlbG9wZXJzLiBQbGVhc2UgZG9uJ3QgdXNlIGRBcHAgZGV2ZWxvcGVycy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgXG4gICAqIDxXYWxsZXRQcm92aWRlciBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjaz17KHVzZXJBZ2VudDogc3RyaW5nKSA9PiB7XG4gICAqICAgcmV0dXJuIC9NeVdhbGxldFxcLy8udGVzdCh1c2VyQWdlbnQpO1xuICAgKiB9fT5cbiAgICogYGBgXG4gICAqL1xuICBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjaz86IChcbiAgICB1c2VyQWdlbnQ6IHN0cmluZyxcbiAgKSA9PiBib29sZWFuO1xufVxuXG5jb25zdCBDT05ORUNUSU9OUyA9IHtcbiAgW0Nvbm5lY3RUeXBlLlJFQURPTkxZXToge1xuICAgIHR5cGU6IENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgIG5hbWU6ICdWaWV3IGFuIGFkZHJlc3MnLFxuICAgIGljb246ICdodHRwczovL2Fzc2V0cy50ZXJyYS5tb25leS9pY29uL3N0YXRpb24tZXh0ZW5zaW9uL2ljb24ucG5nJyxcbiAgfSBhcyBDb25uZWN0aW9uLFxuICBbQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVF06IHtcbiAgICB0eXBlOiBDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNULFxuICAgIG5hbWU6ICdUZXJyYSBTdGF0aW9uIE1vYmlsZScsXG4gICAgaWNvbjogJ2h0dHBzOi8vYXNzZXRzLnRlcnJhLm1vbmV5L2ljb24vc3RhdGlvbi1leHRlbnNpb24vaWNvbi5wbmcnLFxuICB9IGFzIENvbm5lY3Rpb24sXG4gIFtDb25uZWN0VHlwZS5XRUJfQ09OTkVDVF06IHtcbiAgICB0eXBlOiBDb25uZWN0VHlwZS5XRUJfQ09OTkVDVCxcbiAgICBuYW1lOiAnVGVycmEgU3RhdGlvbicsXG4gICAgaWNvbjogJ2h0dHBzOi8vYXNzZXRzLnRlcnJhLm1vbmV5L2ljb24vc3RhdGlvbi1leHRlbnNpb24vaWNvbi5wbmcnLFxuICB9IGFzIENvbm5lY3Rpb24sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBkZWZhdWx0V2FpdGluZ0Nocm9tZUV4dGVuc2lvbkluc3RhbGxDaGVjayA9IDEwMDAgKiAzO1xuXG5leHBvcnQgY2xhc3MgV2FsbGV0Q29udHJvbGxlciB7XG4gIHByaXZhdGUgY2hyb21lRXh0ZW5zaW9uOiBDaHJvbWVFeHRlbnNpb25Db250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgd2ViQ29ubmVjdG9yOiBXZWJDb25uZWN0b3JDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgd2FsbGV0Q29ubmVjdDogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seVdhbGxldDogUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBfYXZhaWxhYmxlQ29ubmVjdFR5cGVzOiBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT47XG4gIHByaXZhdGUgX2F2YWlsYWJsZUluc3RhbGxUeXBlczogQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+O1xuICBwcml2YXRlIF9zdGF0ZXM6IEJlaGF2aW9yU3ViamVjdDxXYWxsZXRTdGF0ZXM+O1xuXG4gIHByaXZhdGUgZGlzYWJsZVJlYWRvbmx5V2FsbGV0OiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlQ2hyb21lRXh0ZW5zaW9uOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlV2ViRXh0ZW5zaW9uOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlV2FsbGV0Q29ubmVjdDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfbm90Q29ubmVjdGVkOiBXYWxsZXRTdGF0ZXM7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2luaXRpYWxpemluZzogV2FsbGV0U3RhdGVzO1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IG9wdGlvbnM6IFdhbGxldENvbnRyb2xsZXJPcHRpb25zKSB7XG4gICAgdGhpcy5fbm90Q29ubmVjdGVkID0ge1xuICAgICAgc3RhdHVzOiBXYWxsZXRTdGF0dXMuV0FMTEVUX05PVF9DT05ORUNURUQsXG4gICAgICBuZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgIH07XG5cbiAgICB0aGlzLl9pbml0aWFsaXppbmcgPSB7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5JTklUSUFMSVpJTkcsXG4gICAgICBuZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgIH07XG5cbiAgICB0aGlzLl9hdmFpbGFibGVDb25uZWN0VHlwZXMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+KFtcbiAgICAgIENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgICAgQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVCxcbiAgICBdKTtcblxuICAgIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT4oW10pO1xuXG4gICAgdGhpcy5fc3RhdGVzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxXYWxsZXRTdGF0ZXM+KHRoaXMuX2luaXRpYWxpemluZyk7XG5cbiAgICBsZXQgbnVtU2Vzc2lvbkNoZWNrOiBudW1iZXIgPSAwO1xuXG4gICAgLy8gd2FpdCBjaGVja2luZyB0aGUgYXZhaWxhYmlsaXR5IG9mIHRoZSBjaHJvbWUgZXh0ZW5zaW9uXG4gICAgLy8gMC4gY2hlY2sgaWYgZXh0ZW5zaW9uIHdhbGxldCBzZXNzaW9uIGlzIGV4aXN0c1xuICAgIGNoZWNrQXZhaWxhYmxlRXh0ZW5zaW9uKFxuICAgICAgb3B0aW9ucy53YWl0aW5nQ2hyb21lRXh0ZW5zaW9uSW5zdGFsbENoZWNrID8/XG4gICAgICAgIGRlZmF1bHRXYWl0aW5nQ2hyb21lRXh0ZW5zaW9uSW5zdGFsbENoZWNrLFxuICAgICAgdGhpcy5pc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyKCksXG4gICAgKS50aGVuKChleHRlbnNpb25UeXBlKSA9PiB7XG4gICAgICBpZiAoZXh0ZW5zaW9uVHlwZSA9PT0gQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1QpIHtcbiAgICAgICAgdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzLm5leHQoW1xuICAgICAgICAgIENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgICAgICAgIENvbm5lY3RUeXBlLldFQl9DT05ORUNULFxuICAgICAgICAgIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHRoaXMud2ViQ29ubmVjdG9yID0gbmV3IFdlYkNvbm5lY3RvckNvbnRyb2xsZXIod2luZG93KTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLndlYkNvbm5lY3RvclxuICAgICAgICAgIC5zdGF0dXMoKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgZmlsdGVyKCh3ZWJFeHRlbnNpb25TdGF0dXMpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICB3ZWJFeHRlbnNpb25TdGF0dXMudHlwZSAhPT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5JTklUSUFMSVpJTkdcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIClcbiAgICAgICAgICAuc3Vic2NyaWJlKCh3ZWJFeHRlbnNpb25TdGF0dXMpID0+IHtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHdlYkV4dGVuc2lvblN0YXR1cy50eXBlID09PSBXZWJDb25uZWN0b3JTdGF0dXNUeXBlLlJFQURZICYmXG4gICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSkgPT09ICd0cnVlJyAmJlxuICAgICAgICAgICAgICAhdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdCAmJlxuICAgICAgICAgICAgICAhdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXRcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmVuYWJsZVdlYkV4dGVuc2lvbigpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChudW1TZXNzaW9uQ2hlY2sgPT09IDApIHtcbiAgICAgICAgICAgICAgbnVtU2Vzc2lvbkNoZWNrICs9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShXRUJfRVhURU5TSU9OX0NPTk5FQ1RFRF9LRVkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChleHRlbnNpb25UeXBlID09PSBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OKSB7XG4gICAgICAgIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5uZXh0KFtcbiAgICAgICAgICBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgICBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OLFxuICAgICAgICAgIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uID0gbmV3IENocm9tZUV4dGVuc2lvbkNvbnRyb2xsZXIoe1xuICAgICAgICAgIGVuYWJsZVdhbGxldENvbm5lY3Rpb246IHRydWUsXG4gICAgICAgICAgZGVmYXVsdE5ldHdvcms6IG9wdGlvbnMuZGVmYXVsdE5ldHdvcmssXG4gICAgICAgICAgc2VsZWN0RXh0ZW5zaW9uOiBvcHRpb25zLnNlbGVjdENocm9tZUV4dGVuc2lvbixcbiAgICAgICAgICBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjazpcbiAgICAgICAgICAgIG9wdGlvbnMuZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2sgPz9cbiAgICAgICAgICAgIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0ssXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuY2hyb21lRXh0ZW5zaW9uXG4gICAgICAgICAgLnN0YXR1cygpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBmaWx0ZXIoKGNocm9tZUV4dGVuc2lvblN0YXR1cykgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIGNocm9tZUV4dGVuc2lvblN0YXR1cyAhPT0gQ2hyb21lRXh0ZW5zaW9uU3RhdHVzLklOSVRJQUxJWklOR1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKVxuICAgICAgICAgIC5zdWJzY3JpYmUoKGNocm9tZUV4dGVuc2lvblN0YXR1cykgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIHt9XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgY2hyb21lRXh0ZW5zaW9uU3RhdHVzID09PVxuICAgICAgICAgICAgICAgIENocm9tZUV4dGVuc2lvblN0YXR1cy5XQUxMRVRfQ09OTkVDVEVEICYmXG4gICAgICAgICAgICAgICF0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ICYmXG4gICAgICAgICAgICAgICF0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuZW5hYmxlQ2hyb21lRXh0ZW5zaW9uKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG51bVNlc3Npb25DaGVjayA9PT0gMCkge1xuICAgICAgICAgICAgICBudW1TZXNzaW9uQ2hlY2sgKz0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNEZXNrdG9wQ2hyb21lKHRoaXMuaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlcigpKSkge1xuICAgICAgICAgIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcy5uZXh0KFtDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobnVtU2Vzc2lvbkNoZWNrID09PSAwKSB7XG4gICAgICAgICAgbnVtU2Vzc2lvbkNoZWNrICs9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gMS4gY2hlY2sgaWYgcmVhZG9ubHkgd2FsbGV0IHNlc3Npb24gaXMgZXhpc3RzXG4gICAgY29uc3QgZHJhZnRSZWFkb25seVdhbGxldCA9IHJlQ29ubmVjdElmU2Vzc2lvbkV4aXN0cygpO1xuXG4gICAgaWYgKGRyYWZ0UmVhZG9ubHlXYWxsZXQpIHtcbiAgICAgIHRoaXMuZW5hYmxlUmVhZG9ubHlXYWxsZXQoZHJhZnRSZWFkb25seVdhbGxldCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gMi4gY2hlY2sgaWYgd2FsbGV0Y29ubmVjdCBzZXNpc29uIGlzIGV4aXN0c1xuICAgIGNvbnN0IGRyYWZ0V2FsbGV0Q29ubmVjdCA9IHdjQ29ubmVjdElmU2Vzc2lvbkV4aXN0cyhvcHRpb25zKTtcblxuICAgIGlmIChcbiAgICAgIGRyYWZ0V2FsbGV0Q29ubmVjdCAmJlxuICAgICAgZHJhZnRXYWxsZXRDb25uZWN0LmdldExhdGVzdFNlc3Npb24oKS5zdGF0dXMgPT09XG4gICAgICAgIFdhbGxldENvbm5lY3RTZXNzaW9uU3RhdHVzLkNPTk5FQ1RFRFxuICAgICkge1xuICAgICAgdGhpcy5lbmFibGVXYWxsZXRDb25uZWN0KGRyYWZ0V2FsbGV0Q29ubmVjdCk7XG4gICAgfSBlbHNlIGlmIChudW1TZXNzaW9uQ2hlY2sgPT09IDApIHtcbiAgICAgIG51bVNlc3Npb25DaGVjayArPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAc2VlIFdhbGxldCNpc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyICovXG4gIGlzQ2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXIgPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMub3B0aW9ucy5kYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjayA/P1xuICAgICAgREVGQVVMVF9DSFJPTUVfRVhURU5TSU9OX0NPTVBBVElCTEVfQlJPV1NFUl9DSEVDS1xuICAgICkobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2F2YWlsYWJsZUNvbm5lY3RUeXBlcyAqL1xuICBhdmFpbGFibGVDb25uZWN0VHlwZXMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0VHlwZVtdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjYXZhaWxhYmxlQ29ubmVjdGlvbnMgKi9cbiAgYXZhaWxhYmxlQ29ubmVjdGlvbnMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0aW9uW10+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzLnBpcGUoXG4gICAgICBtYXAoKGNvbm5lY3RUeXBlcykgPT4ge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uczogQ29ubmVjdGlvbltdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBjb25uZWN0VHlwZSBvZiBjb25uZWN0VHlwZXMpIHtcbiAgICAgICAgICBpZiAoY29ubmVjdFR5cGUgPT09IENvbm5lY3RUeXBlLkNIUk9NRV9FWFRFTlNJT04pIHtcbiAgICAgICAgICAgIGNvbnN0IHRlcnJhRXh0ZW5zaW9ucyA9IGdldFRlcnJhQ2hyb21lRXh0ZW5zaW9ucygpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRlcnJhRXh0ZW5zaW9uIG9mIHRlcnJhRXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgICBjb25uZWN0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OLFxuICAgICAgICAgICAgICAgIC4uLnRlcnJhRXh0ZW5zaW9uLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29ubmVjdGlvbnMucHVzaChDT05ORUNUSU9OU1tjb25uZWN0VHlwZV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb25uZWN0aW9ucztcbiAgICAgIH0pLFxuICAgICk7XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2F2YWlsYWJsZUluc3RhbGxUeXBlcyAqL1xuICBhdmFpbGFibGVJbnN0YWxsVHlwZXMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0VHlwZVtdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjc3RhdHVzXG4gICAqIEBzZWUgV2FsbGV0I25ldHdvcmtcbiAgICogQHNlZSBXYWxsZXQjd2FsbGV0c1xuICAgKi9cbiAgc3RhdGVzID0gKCk6IE9ic2VydmFibGU8V2FsbGV0U3RhdGVzPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKiogQGRlcHJlY2F0ZWQgcGxlYXNlIHVzZSBgc3RhdGVzKClgICovXG4gIHN0YXR1cyA9ICgpOiBPYnNlcnZhYmxlPFdhbGxldFN0YXR1cz4gPT4ge1xuICAgIHJldHVybiB0aGlzLl9zdGF0ZXMucGlwZShtYXAoKGRhdGEpID0+IGRhdGEuc3RhdHVzKSk7XG4gIH07XG5cbiAgLyoqIEBkZXByZWNhdGVkIHBsZWFzZSB1c2UgYHN0YXRlcygpYCAqL1xuICBuZXR3b3JrID0gKCk6IE9ic2VydmFibGU8TmV0d29ya0luZm8+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdGVzLnBpcGUobWFwKChkYXRhKSA9PiBkYXRhLm5ldHdvcmspKTtcbiAgfTtcblxuICAvKiogQGRlcHJlY2F0ZWQgcGxlYXNlIHVzZSBgc3RhdGVzKClgICovXG4gIHdhbGxldHMgPSAoKTogT2JzZXJ2YWJsZTxXYWxsZXRJbmZvW10+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdGVzLnBpcGUoXG4gICAgICBtYXAoKGRhdGEpID0+XG4gICAgICAgIGRhdGEuc3RhdHVzID09PSBXYWxsZXRTdGF0dXMuV0FMTEVUX0NPTk5FQ1RFRCA/IGRhdGEud2FsbGV0cyA6IFtdLFxuICAgICAgKSxcbiAgICApO1xuICB9O1xuXG4gIC8qKiBAc2VlIFdhbGxldCNyZWNoZWNrU3RhdHVzICovXG4gIHJlY2hlY2tTdGF0dXMgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbikge1xuICAgICAgdGhpcy5jaHJvbWVFeHRlbnNpb24/LnJlY2hlY2tTdGF0dXMoKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2luc3RhbGwgKi9cbiAgaW5zdGFsbCA9ICh0eXBlOiBDb25uZWN0VHlwZSkgPT4ge1xuICAgIGlmICh0eXBlID09PSBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OKSB7XG4gICAgICB3aW5kb3cub3BlbihDSFJPTUVfRVhURU5TSU9OX0lOU1RBTExfVVJMLCAnX2JsYW5rJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBDb25uZWN0VHlwZS5XRUJfQ09OTkVDVCkge1xuICAgICAgY29uc3Qgd2ViRXh0ZW5zaW9uU3RhdHVzID0gdGhpcy53ZWJDb25uZWN0b3I/LmdldExhc3RTdGF0dXMoKTtcbiAgICAgIGlmIChcbiAgICAgICAgd2ViRXh0ZW5zaW9uU3RhdHVzPy50eXBlID09PSBXZWJDb25uZWN0b3JTdGF0dXNUeXBlLk5PX0FWQUlMQUJMRSAmJlxuICAgICAgICB3ZWJFeHRlbnNpb25TdGF0dXMuaW5zdGFsbExpbmtcbiAgICAgICkge1xuICAgICAgICB3aW5kb3cub3Blbih3ZWJFeHRlbnNpb25TdGF0dXMuaW5zdGFsbExpbmssICdfYmxhbmsnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKGBDb25uZWN0VHlwZSBcIiR7dHlwZX1cIiBkb2VzIG5vdCBzdXBwb3J0IGluc3RhbGwoKSBmdW5jdGlvbmApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjY29ubmVjdCAqL1xuICBjb25uZWN0ID0gKHR5cGU6IENvbm5lY3RUeXBlLCBpZGVudGlmaWVyPzogc3RyaW5nKSA9PiB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLlJFQURPTkxZOlxuICAgICAgICBjb25zdCBuZXR3b3JrczogTmV0d29ya0luZm9bXSA9IE9iamVjdC5rZXlzKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy53YWxsZXRDb25uZWN0Q2hhaW5JZHMsXG4gICAgICAgICkubWFwKChjaGFpbklkKSA9PiB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzWytjaGFpbklkXSk7XG5cbiAgICAgICAgY29uc3QgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uID1cbiAgICAgICAgICB0aGlzLm9wdGlvbnMuY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uPy4obmV0d29ya3MpID8/XG4gICAgICAgICAgcmVhZG9ubHlXYWxsZXRNb2RhbCh7IG5ldHdvcmtzIH0pO1xuXG4gICAgICAgIGNyZWF0ZVJlYWRvbmx5V2FsbGV0U2Vzc2lvbi50aGVuKChyZWFkb25seVdhbGxldFNlc3Npb24pID0+IHtcbiAgICAgICAgICBpZiAocmVhZG9ubHlXYWxsZXRTZXNzaW9uKSB7XG4gICAgICAgICAgICB0aGlzLmVuYWJsZVJlYWRvbmx5V2FsbGV0KHJlQ29ubmVjdChyZWFkb25seVdhbGxldFNlc3Npb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVDpcbiAgICAgICAgdGhpcy5lbmFibGVXYWxsZXRDb25uZWN0KHdjQ29ubmVjdCh0aGlzLm9wdGlvbnMpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLkNIUk9NRV9FWFRFTlNJT046XG4gICAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uIS5jb25uZWN0KGlkZW50aWZpZXIpLnRoZW4oKHN1Y2Nlc3MpID0+IHtcbiAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgdGhpcy5lbmFibGVDaHJvbWVFeHRlbnNpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1Q6XG4gICAgICAgIHRoaXMuZW5hYmxlV2ViRXh0ZW5zaW9uKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIENvbm5lY3RUeXBlIWApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjY29ubmVjdFJlYWRvbmx5ICovXG4gIGNvbm5lY3RSZWFkb25seSA9ICh0ZXJyYUFkZHJlc3M6IHN0cmluZywgbmV0d29yazogTmV0d29ya0luZm8pID0+IHtcbiAgICB0aGlzLmVuYWJsZVJlYWRvbmx5V2FsbGV0KFxuICAgICAgcmVDb25uZWN0KHtcbiAgICAgICAgdGVycmFBZGRyZXNzLFxuICAgICAgICBuZXR3b3JrLFxuICAgICAgfSksXG4gICAgKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjZGlzY29ubmVjdCAqL1xuICBkaXNjb25uZWN0ID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldCA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24/LigpO1xuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuICAgIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gbnVsbDtcblxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSk7XG4gICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjcG9zdCAqL1xuICBwb3N0ID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgLy8gVE9ETyBub3Qgd29yayBhdCB0aGlzIHRpbWUuIGZvciB0aGUgZnV0dXJlIGV4dGVuc2lvblxuICAgIHR4VGFyZ2V0OiB7IHRlcnJhQWRkcmVzcz86IHN0cmluZyB9ID0ge30sXG4gICk6IFByb21pc2U8VHhSZXN1bHQ+ID0+IHtcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBjaHJvbWUgZXh0ZW5zaW9uIC0gbGVnYWN5IGV4dGVuc2lvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGlmICh0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgIGlmICghdGhpcy5jaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBjaHJvbWVFeHRlbnNpb24gaW5zdGFuY2Ugbm90IGNyZWF0ZWQhYCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uXG4gICAgICAgICAgLy8gVE9ETyBtYWtlIFdhbGxldENvbm5lY3RUeFJlc3VsdCB0byBjb21tb24gdHlwZVxuICAgICAgICAgIC5wb3N0PENyZWF0ZVR4T3B0aW9ucywgeyByZXN1bHQ6IFdhbGxldENvbm5lY3RUeFJlc3VsdCB9Pih0eClcbiAgICAgICAgICAudGhlbigoeyBwYXlsb2FkIH0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnR4LFxuICAgICAgICAgICAgICByZXN1bHQ6IHBheWxvYWQucmVzdWx0LFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgfSBhcyBUeFJlc3VsdDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIENocm9tZUV4dGVuc2lvbkNyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBDcmVhdGVUeEZhaWxlZCh0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR4RmFpbGVkKHR4LCBlcnJvci50eGhhc2gsIGVycm9yLm1lc3NhZ2UsIG51bGwpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIENocm9tZUV4dGVuc2lvblVuc3BlY2lmaWVkRXJyb3IpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR4VW5zcGVjaWZpZWRFcnJvcih0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBVc2VyRGVuaWVkRXJyb3JcbiAgICAgICAgICAgIC8vIEFsbCB1bnNwZWNpZmllZCBlcnJvcnMuLi5cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyB3ZWIgZXh0ZW5zaW9uIC0gbmV3IGV4dGVuc2lvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGVsc2UgaWYgKHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFR4UmVzdWx0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGlmICghdGhpcy53ZWJDb25uZWN0b3IpIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKGB3ZWJFeHRlbnNpb24gaW5zdGFuY2Ugbm90IGNyZWF0ZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdlYkV4dGVuc2lvblN0YXRlcyA9IHRoaXMud2ViQ29ubmVjdG9yLmdldExhc3RTdGF0ZXMoKTtcblxuICAgICAgICBpZiAoIXdlYkV4dGVuc2lvblN0YXRlcykge1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYHdlYkV4dGVuc2lvbi5nZXRMYXN0U3RhdGVzKCkgcmV0dXJucyB1bmRlZmluZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZvY3VzZWRXYWxsZXQgPSB0eFRhcmdldC50ZXJyYUFkZHJlc3NcbiAgICAgICAgICA/IHdlYkV4dGVuc2lvblN0YXRlcy53YWxsZXRzLmZpbmQoXG4gICAgICAgICAgICAgIChpdGVtV2FsbGV0KSA9PiBpdGVtV2FsbGV0LnRlcnJhQWRkcmVzcyA9PT0gdHhUYXJnZXQudGVycmFBZGRyZXNzLFxuICAgICAgICAgICAgKSA/PyB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0c1swXVxuICAgICAgICAgIDogd2ViRXh0ZW5zaW9uU3RhdGVzLmZvY3VzZWRXYWxsZXRBZGRyZXNzXG4gICAgICAgICAgPyB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0cy5maW5kKFxuICAgICAgICAgICAgICAoaXRlbVdhbGxldCkgPT5cbiAgICAgICAgICAgICAgICBpdGVtV2FsbGV0LnRlcnJhQWRkcmVzcyA9PT1cbiAgICAgICAgICAgICAgICB3ZWJFeHRlbnNpb25TdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3MsXG4gICAgICAgICAgICApID8/IHdlYkV4dGVuc2lvblN0YXRlcy53YWxsZXRzWzBdXG4gICAgICAgICAgOiB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0c1swXTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLndlYkNvbm5lY3RvclxuICAgICAgICAgIC5wb3N0KGZvY3VzZWRXYWxsZXQudGVycmFBZGRyZXNzLCB0eClcbiAgICAgICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgIG5leHQ6IChleHRlbnNpb25UeFJlc3VsdDogV2ViQ29ubmVjdG9yVHhSZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgc3dpdGNoIChleHRlbnNpb25UeFJlc3VsdC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFdlYkNvbm5lY3RvclR4U3RhdHVzLlNVQ0NFRUQ6XG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udHgsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdDogZXh0ZW5zaW9uVHhSZXN1bHQucGF5bG9hZCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgV2ViQ29ubmVjdG9yVXNlckRlbmllZCkge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgVXNlckRlbmllZCgpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdlYkNvbm5lY3RvckNyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBDcmVhdGVUeEZhaWxlZCh0eCwgZXJyb3IubWVzc2FnZSkpO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgV2ViQ29ubmVjdG9yVHhGYWlsZWQpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoXG4gICAgICAgICAgICAgICAgICBuZXcgVHhGYWlsZWQoXG4gICAgICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgICAgICBlcnJvci50eGhhc2gsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLnJhd19tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlamVjdChcbiAgICAgICAgICAgICAgICAgIG5ldyBUeFVuc3BlY2lmaWVkRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgaW4gZXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gd2FsbGV0IGNvbm5lY3RcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBlbHNlIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHJldHVybiB0aGlzLndhbGxldENvbm5lY3RcbiAgICAgICAgLnBvc3QodHgpXG4gICAgICAgIC50aGVuKFxuICAgICAgICAgIChyZXN1bHQpID0+XG4gICAgICAgICAgICAoe1xuICAgICAgICAgICAgICAuLi50eCxcbiAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgfSBhcyBUeFJlc3VsdCksXG4gICAgICAgIClcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIGxldCB0aHJvd0Vycm9yID0gZXJyb3I7XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgV2FsbGV0Q29ubmVjdFVzZXJEZW5pZWQpIHtcbiAgICAgICAgICAgICAgdGhyb3dFcnJvciA9IG5ldyBVc2VyRGVuaWVkKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgV2FsbGV0Q29ubmVjdENyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgQ3JlYXRlVHhGYWlsZWQodHgsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdhbGxldENvbm5lY3RUeEZhaWxlZCkge1xuICAgICAgICAgICAgICB0aHJvd0Vycm9yID0gbmV3IFR4RmFpbGVkKFxuICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgIGVycm9yLnR4aGFzaCxcbiAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIGVycm9yLnJhd19tZXNzYWdlLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdhbGxldENvbm5lY3RUaW1lb3V0KSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVGltZW91dChlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBXYWxsZXRDb25uZWN0VHhVbnNwZWNpZmllZEVycm9yKSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVHhVbnNwZWNpZmllZEVycm9yKHR4LCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVHhVbnNwZWNpZmllZEVycm9yKFxuICAgICAgICAgICAgICB0eCxcbiAgICAgICAgICAgICAgJ21lc3NhZ2UnIGluIGVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRocm93IHRocm93RXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIGFyZSBubyBjb25uZWN0aW9ucyB0aGF0IGNhbiBiZSBwb3N0aW5nIHR4IWApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjc2lnbiAqL1xuICBzaWduID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgLy8gVE9ETyBub3Qgd29yayBhdCB0aGlzIHRpbWUuIGZvciB0aGUgZnV0dXJlIGV4dGVuc2lvblxuICAgIHR4VGFyZ2V0OiB7IHRlcnJhQWRkcmVzcz86IHN0cmluZyB9ID0ge30sXG4gICk6IFByb21pc2U8U2lnblJlc3VsdD4gPT4ge1xuICAgIGludGVyZmFjZSBTaWduUmVzdWx0UmF3IGV4dGVuZHMgQ3JlYXRlVHhPcHRpb25zIHtcbiAgICAgIHJlc3VsdDoge1xuICAgICAgICBwdWJsaWNfa2V5OiBzdHJpbmcgfCBQdWJsaWNLZXkuRGF0YTtcbiAgICAgICAgcmVjaWQ6IG51bWJlcjtcbiAgICAgICAgc2lnbmF0dXJlOiBzdHJpbmc7XG4gICAgICAgIHN0ZFNpZ25Nc2dEYXRhOiBTdGRTaWduTXNnLkRhdGE7XG4gICAgICB9O1xuICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kaXNhYmxlQ2hyb21lRXh0ZW5zaW9uKSB7XG4gICAgICBpZiAoIXRoaXMuY2hyb21lRXh0ZW5zaW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgY2hyb21lRXh0ZW5zaW9uIGluc3RhbmNlIG5vdCBjcmVhdGVkIWApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jaHJvbWVFeHRlbnNpb25cbiAgICAgICAgLnNpZ248Q3JlYXRlVHhPcHRpb25zLCBTaWduUmVzdWx0UmF3Pih0eClcbiAgICAgICAgLnRoZW4oKHsgcGF5bG9hZCB9KSA9PiB7XG4gICAgICAgICAgY29uc3QgcHVibGljS2V5OiBQdWJsaWNLZXkuRGF0YSA9XG4gICAgICAgICAgICB0eXBlb2YgcGF5bG9hZC5yZXN1bHQucHVibGljX2tleSA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAndGVuZGVybWludC9QdWJLZXlTZWNwMjU2azEnLFxuICAgICAgICAgICAgICAgICAgdmFsdWU6IHBheWxvYWQucmVzdWx0LnB1YmxpY19rZXksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHBheWxvYWQucmVzdWx0LnB1YmxpY19rZXk7XG5cbiAgICAgICAgICBjb25zdCBzaWduUmVzdWx0OiBTaWduUmVzdWx0WydyZXN1bHQnXSA9IHtcbiAgICAgICAgICAgIC4uLnBheWxvYWQucmVzdWx0LFxuICAgICAgICAgICAgcHVibGljX2tleTogcHVibGljS2V5LFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4udHgsXG4gICAgICAgICAgICByZXN1bHQ6IHNpZ25SZXN1bHQsXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBDaHJvbWVFeHRlbnNpb25DcmVhdGVUeEZhaWxlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IENyZWF0ZVR4RmFpbGVkKHR4LCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeEZhaWxlZCh0eCwgZXJyb3IudHhoYXNoLCBlcnJvci5tZXNzYWdlLCBudWxsKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVW5zcGVjaWZpZWRFcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR4VW5zcGVjaWZpZWRFcnJvcih0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFVzZXJEZW5pZWQgLSBjaHJvbWUgZXh0ZW5zaW9uIHdpbGwgc2VudCBvcmlnaW5hbCBVc2VyRGVuaWVkIGVycm9yIHR5cGVcbiAgICAgICAgICAvLyBBbGwgdW5zcGVjaWZpZWQgZXJyb3JzLi4uXG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgc2lnbigpIG1ldGhvZCBvbmx5IGF2YWlsYWJsZSBvbiBjaHJvbWUgZXh0ZW5zaW9uYCk7XG4gICAgLy8gVE9ETyBpbXBsZW1lbnRzIHNpZ24oKSB0byBvdGhlciBjb25uZWN0IHR5cGVzXG4gIH07XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBpbnRlcm5hbFxuICAvLyBjb25uZWN0IHR5cGUgY2hhbmdpbmdcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBwcml2YXRlIHVwZGF0ZVN0YXRlcyA9IChuZXh0OiBXYWxsZXRTdGF0ZXMpID0+IHtcbiAgICBjb25zdCBwcmV2ID0gdGhpcy5fc3RhdGVzLmdldFZhbHVlKCk7XG5cbiAgICBpZiAoXG4gICAgICBuZXh0LnN0YXR1cyA9PT0gV2FsbGV0U3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgIG5leHQud2FsbGV0cy5sZW5ndGggPT09IDBcbiAgICApIHtcbiAgICAgIGNvbnNvbGUudHJhY2UoJz8/PycpO1xuICAgIH1cblxuICAgIGlmIChwcmV2LnN0YXR1cyAhPT0gbmV4dC5zdGF0dXMgfHwgIWRlZXBFcXVhbChwcmV2LCBuZXh0KSkge1xuICAgICAgdGhpcy5fc3RhdGVzLm5leHQobmV4dCk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlUmVhZG9ubHlXYWxsZXQgPSAocmVhZG9ubHlXYWxsZXQ6IFJlYWRvbmx5V2FsbGV0Q29udHJvbGxlcikgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3Q/LigpO1xuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbj8uKCk7XG4gICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uPy4oKTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMucmVhZG9ubHlXYWxsZXQgPT09IHJlYWRvbmx5V2FsbGV0IHx8XG4gICAgICAodGhpcy5yZWFkb25seVdhbGxldD8udGVycmFBZGRyZXNzID09PSByZWFkb25seVdhbGxldC50ZXJyYUFkZHJlc3MgJiZcbiAgICAgICAgdGhpcy5yZWFkb25seVdhbGxldC5uZXR3b3JrID09PSByZWFkb25seVdhbGxldC5uZXR3b3JrKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlYWRvbmx5V2FsbGV0KSB7XG4gICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0LmRpc2Nvbm5lY3QoKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlYWRvbmx5V2FsbGV0ID0gcmVhZG9ubHlXYWxsZXQ7XG5cbiAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgbmV0d29yazogcmVhZG9ubHlXYWxsZXQubmV0d29yayxcbiAgICAgIHdhbGxldHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNvbm5lY3RUeXBlOiBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgICB0ZXJyYUFkZHJlc3M6IHJlYWRvbmx5V2FsbGV0LnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICBkZXNpZ246ICdyZWFkb25seScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXQgPSAoKSA9PiB7XG4gICAgICByZWFkb25seVdhbGxldC5kaXNjb25uZWN0KCk7XG4gICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0ID0gbnVsbDtcbiAgICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0ID0gbnVsbDtcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlV2ViRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbiB8fCAhdGhpcy53ZWJDb25uZWN0b3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb25TdWJzY3JpcHRpb24gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMud2ViQ29ubmVjdG9yLnN0YXR1cygpLFxuICAgICAgdGhpcy53ZWJDb25uZWN0b3Iuc3RhdGVzKCksXG4gICAgXSkuc3Vic2NyaWJlKChbc3RhdHVzLCBzdGF0ZXNdKSA9PiB7XG4gICAgICBpZiAoIXN0YXRlcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0dXMudHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5SRUFEWSkge1xuICAgICAgICBpZiAoc3RhdGVzLndhbGxldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IGZvY3VzZWRXYWxsZXQgPSBzdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3NcbiAgICAgICAgICAgID8gc3RhdGVzLndhbGxldHMuZmluZChcbiAgICAgICAgICAgICAgICAoaXRlbVdhbGxldCkgPT5cbiAgICAgICAgICAgICAgICAgIGl0ZW1XYWxsZXQudGVycmFBZGRyZXNzID09PSBzdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3MsXG4gICAgICAgICAgICAgICkgPz8gc3RhdGVzLndhbGxldHNbMF1cbiAgICAgICAgICAgIDogc3RhdGVzLndhbGxldHNbMF07XG5cbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgbmV0d29yazogc3RhdGVzLm5ldHdvcmssXG4gICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1QsXG4gICAgICAgICAgICAgICAgdGVycmFBZGRyZXNzOiBmb2N1c2VkV2FsbGV0LnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZXNpZ246IGZvY3VzZWRXYWxsZXQuZGVzaWduLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzdGF0dXMudHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5OT19BVkFJTEFCTEUpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oV0VCX0VYVEVOU0lPTl9DT05ORUNURURfS0VZKTtcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcblxuICAgICAgICBpZiAoIXN0YXR1cy5pc0FwcHJvdmVkICYmIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbikge1xuICAgICAgICAgIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShXRUJfRVhURU5TSU9OX0NPTk5FQ1RFRF9LRVksICd0cnVlJyk7XG5cbiAgICBjb25zdCBsYXN0RXh0ZW5zaW9uU3RhdHVzID0gdGhpcy53ZWJDb25uZWN0b3IuZ2V0TGFzdFN0YXR1cygpO1xuXG4gICAgaWYgKFxuICAgICAgbGFzdEV4dGVuc2lvblN0YXR1cy50eXBlID09PSBXZWJDb25uZWN0b3JTdGF0dXNUeXBlLk5PX0FWQUlMQUJMRSAmJlxuICAgICAgbGFzdEV4dGVuc2lvblN0YXR1cy5pc0FwcHJvdmVkID09PSBmYWxzZVxuICAgICkge1xuICAgICAgdGhpcy53ZWJDb25uZWN0b3IucmVxdWVzdEFwcHJvdmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oV0VCX0VYVEVOU0lPTl9DT05ORUNURURfS0VZKTtcbiAgICAgIGV4dGVuc2lvblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uID0gbnVsbDtcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlQ2hyb21lRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiB8fCAhdGhpcy5jaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb25TdWJzY3JpcHRpb24gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uLnN0YXR1cygpLFxuICAgICAgdGhpcy5jaHJvbWVFeHRlbnNpb24ubmV0d29ya0luZm8oKSxcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uLnRlcnJhQWRkcmVzcygpLFxuICAgIF0pLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAoW3N0YXR1cywgbmV0d29ya0luZm8sIHRlcnJhQWRkcmVzc10pID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHN0YXR1cyA9PT0gQ2hyb21lRXh0ZW5zaW9uU3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgICAgICB0eXBlb2YgdGVycmFBZGRyZXNzID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgIEFjY0FkZHJlc3MudmFsaWRhdGUodGVycmFBZGRyZXNzKVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgbmV0d29yazogbmV0d29ya0luZm8sXG4gICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUuQ0hST01FX0VYVEVOU0lPTixcbiAgICAgICAgICAgICAgICB0ZXJyYUFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZGVzaWduOiAnZXh0ZW5zaW9uJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9ICgpID0+IHtcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uPy5kaXNjb25uZWN0KCk7XG4gICAgICBleHRlbnNpb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9IG51bGw7XG4gICAgfTtcbiAgfTtcblxuICBwcml2YXRlIGVuYWJsZVdhbGxldENvbm5lY3QgPSAod2FsbGV0Q29ubmVjdDogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIpID0+IHtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlQ2hyb21lRXh0ZW5zaW9uPy4oKTtcbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMud2FsbGV0Q29ubmVjdCA9PT0gd2FsbGV0Q29ubmVjdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdC5kaXNjb25uZWN0KCk7XG4gICAgfVxuXG4gICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcblxuICAgIGNvbnN0IHN1YnNjcmliZVdhbGxldENvbm5lY3QgPSAoXG4gICAgICB3YzogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIsXG4gICAgKTogU3Vic2NyaXB0aW9uID0+IHtcbiAgICAgIHJldHVybiB3Yy5zZXNzaW9uKCkuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKHN0YXR1cykgPT4ge1xuICAgICAgICAgIHN3aXRjaCAoc3RhdHVzLnN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBXYWxsZXRDb25uZWN0U2Vzc2lvblN0YXR1cy5DT05ORUNURUQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgICAgIG5ldHdvcms6XG4gICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzW3N0YXR1cy5jaGFpbklkXSA/P1xuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgICAgICAgICAgICAgIHdhbGxldHM6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdFR5cGU6IENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhQWRkcmVzczogc3RhdHVzLnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgZGVzaWduOiAnd2FsbGV0Y29ubmVjdCcsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCB3YWxsZXRDb25uZWN0U2Vzc2lvblN1YnNjcmlwdGlvbiA9XG4gICAgICBzdWJzY3JpYmVXYWxsZXRDb25uZWN0KHdhbGxldENvbm5lY3QpO1xuXG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdCA9ICgpID0+IHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdD8uZGlzY29ubmVjdCgpO1xuICAgICAgdGhpcy53YWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICAgIHdhbGxldENvbm5lY3RTZXNzaW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICB9O1xuICB9O1xufVxuIl19