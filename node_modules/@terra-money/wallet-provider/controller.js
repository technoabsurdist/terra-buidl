import { isDesktopChrome } from '@terra-dev/browser-check';
import { getTerraChromeExtensions, } from '@terra-dev/chrome-extension';
import { readonlyWalletModal } from '@terra-dev/readonly-wallet-modal';
import { ConnectType, WalletStatus, } from '@terra-dev/use-wallet';
import { CreateTxFailed, Timeout, TxFailed, TxUnspecifiedError, UserDenied, } from '@terra-dev/wallet-types';
import { WebConnectorController } from '@terra-dev/web-connector-controller';
import { WebConnectorCreateTxFailed, WebConnectorStatusType, WebConnectorTxFailed, WebConnectorTxStatus, WebConnectorUserDenied, } from '@terra-dev/web-connector-interface';
import { AccAddress, } from '@terra-money/terra.js';
import deepEqual from 'fast-deep-equal';
import { BehaviorSubject, combineLatest } from 'rxjs';
import { filter, map } from 'rxjs/operators';
import { CHROME_EXTENSION_INSTALL_URL, DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK, WEB_EXTENSION_CONNECTED_KEY, } from './env';
import { ChromeExtensionController, ChromeExtensionCreateTxFailed, ChromeExtensionStatus, ChromeExtensionTxFailed, ChromeExtensionUnspecifiedError, } from './modules/chrome-extension';
import { connect as reConnect, connectIfSessionExists as reConnectIfSessionExists, } from './modules/readonly-wallet';
import { connect as wcConnect, connectIfSessionExists as wcConnectIfSessionExists, WalletConnectCreateTxFailed, WalletConnectSessionStatus, WalletConnectTimeout, WalletConnectTxFailed, WalletConnectTxUnspecifiedError, WalletConnectUserDenied, } from './modules/walletconnect';
import { checkAvailableExtension } from './utils/checkAvailableExtension';
const CONNECTIONS = {
    [ConnectType.READONLY]: {
        type: ConnectType.READONLY,
        name: 'View an address',
        icon: 'https://assets.terra.money/icon/station-extension/icon.png',
    },
    [ConnectType.WALLETCONNECT]: {
        type: ConnectType.WALLETCONNECT,
        name: 'Terra Station Mobile',
        icon: 'https://assets.terra.money/icon/station-extension/icon.png',
    },
    [ConnectType.WEB_CONNECT]: {
        type: ConnectType.WEB_CONNECT,
        name: 'Terra Station',
        icon: 'https://assets.terra.money/icon/station-extension/icon.png',
    },
};
const defaultWaitingChromeExtensionInstallCheck = 1000 * 3;
export class WalletController {
    constructor(options) {
        var _a;
        this.options = options;
        this.chromeExtension = null;
        this.webConnector = null;
        this.walletConnect = null;
        this.readonlyWallet = null;
        this.disableReadonlyWallet = null;
        this.disableChromeExtension = null;
        this.disableWebExtension = null;
        this.disableWalletConnect = null;
        /** @see Wallet#isChromeExtensionCompatibleBrowser */
        this.isChromeExtensionCompatibleBrowser = () => {
            var _a;
            return ((_a = this.options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK)(navigator.userAgent);
        };
        /** @see Wallet#availableConnectTypes */
        this.availableConnectTypes = () => {
            return this._availableConnectTypes.asObservable();
        };
        /** @see Wallet#availableConnections */
        this.availableConnections = () => {
            return this._availableConnectTypes.pipe(map((connectTypes) => {
                const connections = [];
                for (const connectType of connectTypes) {
                    if (connectType === ConnectType.CHROME_EXTENSION) {
                        const terraExtensions = getTerraChromeExtensions();
                        for (const terraExtension of terraExtensions) {
                            connections.push({
                                type: ConnectType.CHROME_EXTENSION,
                                ...terraExtension,
                            });
                        }
                    }
                    else {
                        connections.push(CONNECTIONS[connectType]);
                    }
                }
                return connections;
            }));
        };
        /** @see Wallet#availableInstallTypes */
        this.availableInstallTypes = () => {
            return this._availableInstallTypes.asObservable();
        };
        /**
         * @see Wallet#status
         * @see Wallet#network
         * @see Wallet#wallets
         */
        this.states = () => {
            return this._states.asObservable();
        };
        /** @deprecated please use `states()` */
        this.status = () => {
            return this._states.pipe(map((data) => data.status));
        };
        /** @deprecated please use `states()` */
        this.network = () => {
            return this._states.pipe(map((data) => data.network));
        };
        /** @deprecated please use `states()` */
        this.wallets = () => {
            return this._states.pipe(map((data) => data.status === WalletStatus.WALLET_CONNECTED ? data.wallets : []));
        };
        /** @see Wallet#recheckStatus */
        this.recheckStatus = () => {
            var _a;
            if (this.disableChromeExtension) {
                (_a = this.chromeExtension) === null || _a === void 0 ? void 0 : _a.recheckStatus();
            }
        };
        /** @see Wallet#install */
        this.install = (type) => {
            var _a;
            if (type === ConnectType.CHROME_EXTENSION) {
                window.open(CHROME_EXTENSION_INSTALL_URL, '_blank');
            }
            else if (type === ConnectType.WEB_CONNECT) {
                const webExtensionStatus = (_a = this.webConnector) === null || _a === void 0 ? void 0 : _a.getLastStatus();
                if ((webExtensionStatus === null || webExtensionStatus === void 0 ? void 0 : webExtensionStatus.type) === WebConnectorStatusType.NO_AVAILABLE &&
                    webExtensionStatus.installLink) {
                    window.open(webExtensionStatus.installLink, '_blank');
                }
            }
            else {
                console.warn(`ConnectType "${type}" does not support install() function`);
            }
        };
        /** @see Wallet#connect */
        this.connect = (type, identifier) => {
            var _a, _b, _c;
            switch (type) {
                case ConnectType.READONLY:
                    const networks = Object.keys(this.options.walletConnectChainIds).map((chainId) => this.options.walletConnectChainIds[+chainId]);
                    const createReadonlyWalletSession = (_c = (_b = (_a = this.options).createReadonlyWalletSession) === null || _b === void 0 ? void 0 : _b.call(_a, networks)) !== null && _c !== void 0 ? _c : readonlyWalletModal({ networks });
                    createReadonlyWalletSession.then((readonlyWalletSession) => {
                        if (readonlyWalletSession) {
                            this.enableReadonlyWallet(reConnect(readonlyWalletSession));
                        }
                    });
                    break;
                case ConnectType.WALLETCONNECT:
                    this.enableWalletConnect(wcConnect(this.options));
                    break;
                case ConnectType.CHROME_EXTENSION:
                    this.chromeExtension.connect(identifier).then((success) => {
                        if (success) {
                            this.enableChromeExtension();
                        }
                    });
                    break;
                case ConnectType.WEB_CONNECT:
                    this.enableWebExtension();
                    break;
                default:
                    throw new Error(`Unknown ConnectType!`);
            }
        };
        /** @see Wallet#connectReadonly */
        this.connectReadonly = (terraAddress, network) => {
            this.enableReadonlyWallet(reConnect({
                terraAddress,
                network,
            }));
        };
        /** @see Wallet#disconnect */
        this.disconnect = () => {
            var _a, _b, _c, _d;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            this.disableReadonlyWallet = null;
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            this.disableChromeExtension = null;
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            this.disableWebExtension = null;
            (_d = this.disableWalletConnect) === null || _d === void 0 ? void 0 : _d.call(this);
            this.disableWalletConnect = null;
            localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
            this.updateStates(this._notConnected);
        };
        /** @see Wallet#post */
        this.post = async (tx, 
        // TODO not work at this time. for the future extension
        txTarget = {}) => {
            // ---------------------------------------------
            // chrome extension - legacy extension
            // ---------------------------------------------
            if (this.disableChromeExtension) {
                if (!this.chromeExtension) {
                    throw new Error(`chromeExtension instance not created!`);
                }
                return (this.chromeExtension
                    // TODO make WalletConnectTxResult to common type
                    .post(tx)
                    .then(({ payload }) => {
                    return {
                        ...tx,
                        result: payload.result,
                        success: true,
                    };
                })
                    .catch((error) => {
                    if (error instanceof ChromeExtensionCreateTxFailed) {
                        throw new CreateTxFailed(tx, error.message);
                    }
                    else if (error instanceof ChromeExtensionTxFailed) {
                        throw new TxFailed(tx, error.txhash, error.message, null);
                    }
                    else if (error instanceof ChromeExtensionUnspecifiedError) {
                        throw new TxUnspecifiedError(tx, error.message);
                    }
                    // UserDeniedError
                    // All unspecified errors...
                    throw error;
                }));
            }
            // ---------------------------------------------
            // web extension - new extension
            // ---------------------------------------------
            else if (this.disableWebExtension) {
                return new Promise((resolve, reject) => {
                    var _a, _b;
                    if (!this.webConnector) {
                        reject(new Error(`webExtension instance not created!`));
                        return;
                    }
                    const webExtensionStates = this.webConnector.getLastStates();
                    if (!webExtensionStates) {
                        reject(new Error(`webExtension.getLastStates() returns undefined!`));
                        return;
                    }
                    const focusedWallet = txTarget.terraAddress
                        ? (_a = webExtensionStates.wallets.find((itemWallet) => itemWallet.terraAddress === txTarget.terraAddress)) !== null && _a !== void 0 ? _a : webExtensionStates.wallets[0]
                        : webExtensionStates.focusedWalletAddress
                            ? (_b = webExtensionStates.wallets.find((itemWallet) => itemWallet.terraAddress ===
                                webExtensionStates.focusedWalletAddress)) !== null && _b !== void 0 ? _b : webExtensionStates.wallets[0]
                            : webExtensionStates.wallets[0];
                    const subscription = this.webConnector
                        .post(focusedWallet.terraAddress, tx)
                        .subscribe({
                        next: (extensionTxResult) => {
                            switch (extensionTxResult.status) {
                                case WebConnectorTxStatus.SUCCEED:
                                    resolve({
                                        ...tx,
                                        result: extensionTxResult.payload,
                                        success: true,
                                    });
                                    subscription.unsubscribe();
                                    break;
                            }
                        },
                        error: (error) => {
                            if (error instanceof WebConnectorUserDenied) {
                                reject(new UserDenied());
                            }
                            else if (error instanceof WebConnectorCreateTxFailed) {
                                reject(new CreateTxFailed(tx, error.message));
                            }
                            else if (error instanceof WebConnectorTxFailed) {
                                reject(new TxFailed(tx, error.txhash, error.message, error.raw_message));
                            }
                            else {
                                reject(new TxUnspecifiedError(tx, 'message' in error ? error.message : String(error)));
                            }
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            // ---------------------------------------------
            // wallet connect
            // ---------------------------------------------
            else if (this.walletConnect) {
                return this.walletConnect
                    .post(tx)
                    .then((result) => ({
                    ...tx,
                    result,
                    success: true,
                }))
                    .catch((error) => {
                    let throwError = error;
                    try {
                        if (error instanceof WalletConnectUserDenied) {
                            throwError = new UserDenied();
                        }
                        else if (error instanceof WalletConnectCreateTxFailed) {
                            throwError = new CreateTxFailed(tx, error.message);
                        }
                        else if (error instanceof WalletConnectTxFailed) {
                            throwError = new TxFailed(tx, error.txhash, error.message, error.raw_message);
                        }
                        else if (error instanceof WalletConnectTimeout) {
                            throwError = new Timeout(error.message);
                        }
                        else if (error instanceof WalletConnectTxUnspecifiedError) {
                            throwError = new TxUnspecifiedError(tx, error.message);
                        }
                    }
                    catch (_a) {
                        throwError = new TxUnspecifiedError(tx, 'message' in error ? error.message : String(error));
                    }
                    throw throwError;
                });
            }
            else {
                throw new Error(`There are no connections that can be posting tx!`);
            }
        };
        /** @see Wallet#sign */
        this.sign = async (tx, 
        // TODO not work at this time. for the future extension
        txTarget = {}) => {
            if (this.disableChromeExtension) {
                if (!this.chromeExtension) {
                    throw new Error(`chromeExtension instance not created!`);
                }
                return this.chromeExtension
                    .sign(tx)
                    .then(({ payload }) => {
                    const publicKey = typeof payload.result.public_key === 'string'
                        ? {
                            type: 'tendermint/PubKeySecp256k1',
                            value: payload.result.public_key,
                        }
                        : payload.result.public_key;
                    const signResult = {
                        ...payload.result,
                        public_key: publicKey,
                    };
                    return {
                        ...tx,
                        result: signResult,
                        success: true,
                    };
                })
                    .catch((error) => {
                    if (error instanceof ChromeExtensionCreateTxFailed) {
                        throw new CreateTxFailed(tx, error.message);
                    }
                    else if (error instanceof ChromeExtensionTxFailed) {
                        throw new TxFailed(tx, error.txhash, error.message, null);
                    }
                    else if (error instanceof ChromeExtensionUnspecifiedError) {
                        throw new TxUnspecifiedError(tx, error.message);
                    }
                    // UserDenied - chrome extension will sent original UserDenied error type
                    // All unspecified errors...
                    throw error;
                });
            }
            throw new Error(`sign() method only available on chrome extension`);
            // TODO implements sign() to other connect types
        };
        // ================================================================
        // internal
        // connect type changing
        // ================================================================
        this.updateStates = (next) => {
            const prev = this._states.getValue();
            if (next.status === WalletStatus.WALLET_CONNECTED &&
                next.wallets.length === 0) {
                console.trace('???');
            }
            if (prev.status !== next.status || !deepEqual(prev, next)) {
                this._states.next(next);
            }
        };
        this.enableReadonlyWallet = (readonlyWallet) => {
            var _a, _b, _c, _d;
            (_a = this.disableWalletConnect) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.readonlyWallet === readonlyWallet ||
                (((_d = this.readonlyWallet) === null || _d === void 0 ? void 0 : _d.terraAddress) === readonlyWallet.terraAddress &&
                    this.readonlyWallet.network === readonlyWallet.network)) {
                return;
            }
            if (this.readonlyWallet) {
                this.readonlyWallet.disconnect();
            }
            this.readonlyWallet = readonlyWallet;
            this.updateStates({
                status: WalletStatus.WALLET_CONNECTED,
                network: readonlyWallet.network,
                wallets: [
                    {
                        connectType: ConnectType.READONLY,
                        terraAddress: readonlyWallet.terraAddress,
                        design: 'readonly',
                    },
                ],
            });
            this.disableReadonlyWallet = () => {
                readonlyWallet.disconnect();
                this.readonlyWallet = null;
                this.disableReadonlyWallet = null;
            };
        };
        this.enableWebExtension = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableChromeExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.disableWebExtension || !this.webConnector) {
                return;
            }
            const extensionSubscription = combineLatest([
                this.webConnector.status(),
                this.webConnector.states(),
            ]).subscribe(([status, states]) => {
                var _a;
                if (!states) {
                    return;
                }
                if (status.type === WebConnectorStatusType.READY) {
                    if (states.wallets.length > 0) {
                        const focusedWallet = states.focusedWalletAddress
                            ? (_a = states.wallets.find((itemWallet) => itemWallet.terraAddress === states.focusedWalletAddress)) !== null && _a !== void 0 ? _a : states.wallets[0]
                            : states.wallets[0];
                        this.updateStates({
                            status: WalletStatus.WALLET_CONNECTED,
                            network: states.network,
                            wallets: [
                                {
                                    connectType: ConnectType.WEB_CONNECT,
                                    terraAddress: focusedWallet.terraAddress,
                                    design: focusedWallet.design,
                                },
                            ],
                        });
                    }
                }
                else if (status.type === WebConnectorStatusType.NO_AVAILABLE) {
                    localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
                    this.updateStates(this._notConnected);
                    if (!status.isApproved && this.disableWebExtension) {
                        this.disableWebExtension();
                    }
                }
            });
            localStorage.setItem(WEB_EXTENSION_CONNECTED_KEY, 'true');
            const lastExtensionStatus = this.webConnector.getLastStatus();
            if (lastExtensionStatus.type === WebConnectorStatusType.NO_AVAILABLE &&
                lastExtensionStatus.isApproved === false) {
                this.webConnector.requestApproval();
            }
            this.disableWebExtension = () => {
                localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
                extensionSubscription.unsubscribe();
                this.disableWebExtension = null;
            };
        };
        this.enableChromeExtension = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.disableChromeExtension || !this.chromeExtension) {
                return;
            }
            const extensionSubscription = combineLatest([
                this.chromeExtension.status(),
                this.chromeExtension.networkInfo(),
                this.chromeExtension.terraAddress(),
            ]).subscribe({
                next: ([status, networkInfo, terraAddress]) => {
                    if (status === ChromeExtensionStatus.WALLET_CONNECTED &&
                        typeof terraAddress === 'string' &&
                        AccAddress.validate(terraAddress)) {
                        this.updateStates({
                            status: WalletStatus.WALLET_CONNECTED,
                            network: networkInfo,
                            wallets: [
                                {
                                    connectType: ConnectType.CHROME_EXTENSION,
                                    terraAddress,
                                    design: 'extension',
                                },
                            ],
                        });
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                },
            });
            this.disableChromeExtension = () => {
                var _a;
                (_a = this.chromeExtension) === null || _a === void 0 ? void 0 : _a.disconnect();
                extensionSubscription.unsubscribe();
                this.disableChromeExtension = null;
            };
        };
        this.enableWalletConnect = (walletConnect) => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.walletConnect === walletConnect) {
                return;
            }
            if (this.walletConnect) {
                this.walletConnect.disconnect();
            }
            this.walletConnect = walletConnect;
            const subscribeWalletConnect = (wc) => {
                return wc.session().subscribe({
                    next: (status) => {
                        var _a;
                        switch (status.status) {
                            case WalletConnectSessionStatus.CONNECTED:
                                this.updateStates({
                                    status: WalletStatus.WALLET_CONNECTED,
                                    network: (_a = this.options.walletConnectChainIds[status.chainId]) !== null && _a !== void 0 ? _a : this.options.defaultNetwork,
                                    wallets: [
                                        {
                                            connectType: ConnectType.WALLETCONNECT,
                                            terraAddress: status.terraAddress,
                                            design: 'walletconnect',
                                        },
                                    ],
                                });
                                break;
                            default:
                                this.updateStates(this._notConnected);
                                break;
                        }
                    },
                });
            };
            const walletConnectSessionSubscription = subscribeWalletConnect(walletConnect);
            this.disableWalletConnect = () => {
                var _a;
                (_a = this.walletConnect) === null || _a === void 0 ? void 0 : _a.disconnect();
                this.walletConnect = null;
                walletConnectSessionSubscription.unsubscribe();
                this.disableWalletConnect = null;
            };
        };
        this._notConnected = {
            status: WalletStatus.WALLET_NOT_CONNECTED,
            network: options.defaultNetwork,
        };
        this._initializing = {
            status: WalletStatus.INITIALIZING,
            network: options.defaultNetwork,
        };
        this._availableConnectTypes = new BehaviorSubject([
            ConnectType.READONLY,
            ConnectType.WALLETCONNECT,
        ]);
        this._availableInstallTypes = new BehaviorSubject([]);
        this._states = new BehaviorSubject(this._initializing);
        let numSessionCheck = 0;
        // wait checking the availability of the chrome extension
        // 0. check if extension wallet session is exists
        checkAvailableExtension((_a = options.waitingChromeExtensionInstallCheck) !== null && _a !== void 0 ? _a : defaultWaitingChromeExtensionInstallCheck, this.isChromeExtensionCompatibleBrowser()).then((extensionType) => {
            var _a;
            if (extensionType === ConnectType.WEB_CONNECT) {
                this._availableConnectTypes.next([
                    ConnectType.READONLY,
                    ConnectType.WEB_CONNECT,
                    ConnectType.WALLETCONNECT,
                ]);
                this.webConnector = new WebConnectorController(window);
                const subscription = this.webConnector
                    .status()
                    .pipe(filter((webExtensionStatus) => {
                    return (webExtensionStatus.type !== WebConnectorStatusType.INITIALIZING);
                }))
                    .subscribe((webExtensionStatus) => {
                    subscription.unsubscribe();
                    if (webExtensionStatus.type === WebConnectorStatusType.READY &&
                        localStorage.getItem(WEB_EXTENSION_CONNECTED_KEY) === 'true' &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableWebExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                        localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
                    }
                });
            }
            else if (extensionType === ConnectType.CHROME_EXTENSION) {
                this._availableConnectTypes.next([
                    ConnectType.READONLY,
                    ConnectType.CHROME_EXTENSION,
                    ConnectType.WALLETCONNECT,
                ]);
                this.chromeExtension = new ChromeExtensionController({
                    enableWalletConnection: true,
                    defaultNetwork: options.defaultNetwork,
                    selectExtension: options.selectChromeExtension,
                    dangerously__chromeExtensionCompatibleBrowserCheck: (_a = options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK,
                });
                const subscription = this.chromeExtension
                    .status()
                    .pipe(filter((chromeExtensionStatus) => {
                    return (chromeExtensionStatus !== ChromeExtensionStatus.INITIALIZING);
                }))
                    .subscribe((chromeExtensionStatus) => {
                    try {
                        subscription.unsubscribe();
                    }
                    catch (_a) { }
                    if (chromeExtensionStatus ===
                        ChromeExtensionStatus.WALLET_CONNECTED &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableChromeExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                });
            }
            else {
                if (isDesktopChrome(this.isChromeExtensionCompatibleBrowser())) {
                    this._availableInstallTypes.next([ConnectType.CHROME_EXTENSION]);
                }
                if (numSessionCheck === 0) {
                    numSessionCheck += 1;
                }
                else {
                    this.updateStates(this._notConnected);
                }
            }
        });
        // 1. check if readonly wallet session is exists
        const draftReadonlyWallet = reConnectIfSessionExists();
        if (draftReadonlyWallet) {
            this.enableReadonlyWallet(draftReadonlyWallet);
            return;
        }
        // 2. check if walletconnect sesison is exists
        const draftWalletConnect = wcConnectIfSessionExists(options);
        if (draftWalletConnect &&
            draftWalletConnect.getLatestSession().status ===
                WalletConnectSessionStatus.CONNECTED) {
            this.enableWalletConnect(draftWalletConnect);
        }
        else if (numSessionCheck === 0) {
            numSessionCheck += 1;
        }
        else {
            this.updateStates(this._notConnected);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9AdGVycmEtbW9uZXkvd2FsbGV0LXByb3ZpZGVyL2NvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzNELE9BQU8sRUFFTCx3QkFBd0IsR0FDekIsTUFBTSw2QkFBNkIsQ0FBQztBQUNyQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN2RSxPQUFPLEVBRUwsV0FBVyxFQUlYLFlBQVksR0FDYixNQUFNLHVCQUF1QixDQUFDO0FBQy9CLE9BQU8sRUFDTCxjQUFjLEVBR2QsT0FBTyxFQUNQLFFBQVEsRUFDUixrQkFBa0IsRUFDbEIsVUFBVSxHQUNYLE1BQU0seUJBQXlCLENBQUM7QUFDakMsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDN0UsT0FBTyxFQUNMLDBCQUEwQixFQUMxQixzQkFBc0IsRUFDdEIsb0JBQW9CLEVBRXBCLG9CQUFvQixFQUNwQixzQkFBc0IsR0FDdkIsTUFBTSxvQ0FBb0MsQ0FBQztBQUM1QyxPQUFPLEVBQ0wsVUFBVSxHQUlYLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxTQUFTLE1BQU0saUJBQWlCLENBQUM7QUFDeEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQTRCLE1BQU0sTUFBTSxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUNMLDRCQUE0QixFQUM1QixpREFBaUQsRUFDakQsMkJBQTJCLEdBQzVCLE1BQU0sT0FBTyxDQUFDO0FBQ2YsT0FBTyxFQUNMLHlCQUF5QixFQUN6Qiw2QkFBNkIsRUFDN0IscUJBQXFCLEVBQ3JCLHVCQUF1QixFQUN2QiwrQkFBK0IsR0FDaEMsTUFBTSw0QkFB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Q0FBQyxJQUFJLENBQUMsa0NBQWtDLEVBQUUsQ0FBQyxFQUFFO29CQUM5RCxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztpQkFDbEU7Z0JBRUQsSUFBSSxlQUFlLEtBQUssQ0FBQyxFQUFFO29CQUN6QixlQUFlLElBQUksQ0FBQyxDQUFDO2lCQUN0QjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztpQkFDdkM7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsZ0RBQWdEO1FBQ2hELE1BQU0sbUJBQW1CLEdBQUcsd0JBQXdCLEVBQUUsQ0FBQztRQUV2RCxJQUFJLG1CQUFtQixFQUFFO1lBQ3ZCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQy9DLE9BQU87U0FDUjtRQUVELDhDQUE4QztRQUM5QyxNQUFNLGtCQUFrQixHQUFHLHdCQUF3QixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTdELElBQ0Usa0JBQWtCO1lBQ2xCLGtCQUFrQixDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTTtnQkFDMUMsMEJBQTBCLENBQUMsU0FBUyxFQUN0QztZQUNBLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQzlDO2FBQU0sSUFBSSxlQUFlLEtBQUssQ0FBQyxFQUFFO1lBQ2hDLGVBQWUsSUFBSSxDQUFDLENBQUM7U0FDdEI7YUFBTTtZQUNMLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3ZDO0lBQ0gsQ0FBQztDQTBsQkYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc0Rlc2t0b3BDaHJvbWUgfSBmcm9tICdAdGVycmEtZGV2L2Jyb3dzZXItY2hlY2snO1xuaW1wb3J0IHtcbiAgQ2hyb21lRXh0ZW5zaW9uSW5mbyxcbiAgZ2V0VGVycmFDaHJvbWVFeHRlbnNpb25zLFxufSBmcm9tICdAdGVycmEtZGV2L2Nocm9tZS1leHRlbnNpb24nO1xuaW1wb3J0IHsgcmVhZG9ubHlXYWxsZXRNb2RhbCB9IGZyb20gJ0B0ZXJyYS1kZXYvcmVhZG9ubHktd2FsbGV0LW1vZGFsJztcbmltcG9ydCB7XG4gIENvbm5lY3Rpb24sXG4gIENvbm5lY3RUeXBlLFxuICBUeFJlc3VsdCxcbiAgV2FsbGV0SW5mbyxcbiAgV2FsbGV0U3RhdGVzLFxuICBXYWxsZXRTdGF0dXMsXG59IGZyb20gJ0B0ZXJyYS1kZXYvdXNlLXdhbGxldCc7XG5pbXBvcnQge1xuICBDcmVhdGVUeEZhaWxlZCxcbiAgTmV0d29ya0luZm8sXG4gIFNpZ25SZXN1bHQsXG4gIFRpbWVvdXQsXG4gIFR4RmFpbGVkLFxuICBUeFVuc3BlY2lmaWVkRXJyb3IsXG4gIFVzZXJEZW5pZWQsXG59IGZyb20gJ0B0ZXJyYS1kZXYvd2FsbGV0LXR5cGVzJztcbmltcG9ydCB7IFdlYkNvbm5lY3RvckNvbnRyb2xsZXIgfSBmcm9tICdAdGVycmEtZGV2L3dlYi1jb25uZWN0b3ItY29udHJvbGxlcic7XG5pbXBvcnQge1xuICBXZWJDb25uZWN0b3JDcmVhdGVUeEZhaWxlZCxcbiAgV2ViQ29ubmVjdG9yU3RhdHVzVHlwZSxcbiAgV2ViQ29ubmVjdG9yVHhGYWlsZWQsXG4gIFdlYkNvbm5lY3RvclR4UmVzdWx0LFxuICBXZWJDb25uZWN0b3JUeFN0YXR1cyxcbiAgV2ViQ29ubmVjdG9yVXNlckRlbmllZCxcbn0gZnJvbSAnQHRlcnJhLWRldi93ZWItY29ubmVjdG9yLWludGVyZmFjZSc7XG5pbXBvcnQge1xuICBBY2NBZGRyZXNzLFxuICBDcmVhdGVUeE9wdGlvbnMsXG4gIFB1YmxpY0tleSxcbiAgU3RkU2lnbk1zZyxcbn0gZnJvbSAnQHRlcnJhLW1vbmV5L3RlcnJhLmpzJztcbmltcG9ydCBkZWVwRXF1YWwgZnJvbSAnZmFzdC1kZWVwLWVxdWFsJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgY29tYmluZUxhdGVzdCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIENIUk9NRV9FWFRFTlNJT05fSU5TVEFMTF9VUkwsXG4gIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0ssXG4gIFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSxcbn0gZnJvbSAnLi9lbnYnO1xuaW1wb3J0IHtcbiAgQ2hyb21lRXh0ZW5zaW9uQ29udHJvbGxlcixcbiAgQ2hyb21lRXh0ZW5zaW9uQ3JlYXRlVHhGYWlsZWQsXG4gIENocm9tZUV4dGVuc2lvblN0YXR1cyxcbiAgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQsXG4gIENocm9tZUV4dGVuc2lvblVuc3BlY2lmaWVkRXJyb3IsXG59IGZyb20gJy4vbW9kdWxlcy9jaHJvbWUtZXh0ZW5zaW9uJztcbmltcG9ydCB7XG4gIGNvbm5lY3QgYXMgcmVDb25uZWN0LFxuICBjb25uZWN0SWZTZXNzaW9uRXhpc3RzIGFzIHJlQ29ubmVjdElmU2Vzc2lvbkV4aXN0cyxcbiAgUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyLFxuICBSZWFkb25seVdhbGxldFNlc3Npb24sXG59IGZyb20gJy4vbW9kdWxlcy9yZWFkb25seS13YWxsZXQnO1xuaW1wb3J0IHtcbiAgY29ubmVjdCBhcyB3Y0Nvbm5lY3QsXG4gIGNvbm5lY3RJZlNlc3Npb25FeGlzdHMgYXMgd2NDb25uZWN0SWZTZXNzaW9uRXhpc3RzLFxuICBXYWxsZXRDb25uZWN0Q29udHJvbGxlcixcbiAgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zLFxuICBXYWxsZXRDb25uZWN0Q3JlYXRlVHhGYWlsZWQsXG4gIFdhbGxldENvbm5lY3RTZXNzaW9uU3RhdHVzLFxuICBXYWxsZXRDb25uZWN0VGltZW91dCxcbiAgV2FsbGV0Q29ubmVjdFR4RmFpbGVkLFxuICBXYWxsZXRDb25uZWN0VHhSZXN1bHQsXG4gIFdhbGxldENvbm5lY3RUeFVuc3BlY2lmaWVkRXJyb3IsXG4gIFdhbGxldENvbm5lY3RVc2VyRGVuaWVkLFxufSBmcm9tICcuL21vZHVsZXMvd2FsbGV0Y29ubmVjdCc7XG5pbXBvcnQgeyBjaGVja0F2YWlsYWJsZUV4dGVuc2lvbiB9IGZyb20gJy4vdXRpbHMvY2hlY2tBdmFpbGFibGVFeHRlbnNpb24nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdhbGxldENvbnRyb2xsZXJPcHRpb25zXG4gIGV4dGVuZHMgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zIHtcbiAgLyoqXG4gICAqIOKaoO+4jyBEb24ndCBoYXJkY29kaW5nIHRoaXMsIHVzZSBnZXRDaGFpbiBPcHRpb25zKClcbiAgICpcbiAgICogZmFsbGJhY2sgbmV0d29yayBpZiBjb250cm9sbGVyIGlzIG5vdCBjb25uZWN0ZWRcbiAgICovXG4gIGRlZmF1bHROZXR3b3JrOiBOZXR3b3JrSW5mbztcblxuICAvKipcbiAgICog4pqg77iPIERvbid0IGhhcmRjb2RpbmcgdGhpcywgdXNlIGdldENoYWluIE9wdGlvbnMoKVxuICAgKlxuICAgKiBmb3Igd2FsbGV0Y29ubmVjdFxuICAgKlxuICAgKiBUaGUgbmV0d29yayBydWxlcyBwYXNzZWQgYnkgdGhlIFRlcnJhIFN0YXRpb24gTW9iaWxlIGFyZSAwIGlzIHRlc3RuZXQsIDEgaXMgbWFpbm5ldC5cbiAgICpcbiAgICogQWx3YXlzIHNldCB0ZXN0bmV0IGZvciAwIGFuZCBtYWlubmV0IGZvciAxLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBcbiAgICogY29uc3QgbWFpbm5ldDogTmV0d29ya0luZm8gPSB7XG4gICAqICBuYW1lOiAnbWFpbm5ldCcsXG4gICAqICBjaGFpbklEOiAnY29sdW1idXMtNScsXG4gICAqICBsY2Q6ICdodHRwczovL2xjZC50ZXJyYS5kZXYnLFxuICAgKiB9XG4gICAqXG4gICAqIGNvbnN0IHRlc3RuZXQ6IE5ldHdvcmtJbmZvID0ge1xuICAgKiAgbmFtZTogJ3Rlc3RuZXQnLFxuICAgKiAgY2hhaW5JRDogJ2JvbWJheS0xMicsXG4gICAqICBsY2Q6ICdodHRwczovL2JvbWJheS1sY2QudGVycmEuZGV2JyxcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPiA9IHtcbiAgICogICAwOiB0ZXN0bmV0LFxuICAgKiAgIDE6IG1haW5uZXQsXG4gICAqIH1cbiAgICpcbiAgICogPFdhbGxldFByb3ZpZGVyIHdhbGxldENvbm5lY3RDaGFpbklkcz17d2FsbGV0Q29ubmVjdENoYWluSWRzfT5cbiAgICogYGBgXG4gICAqL1xuICB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPjtcblxuICAvKipcbiAgICogcnVuIGF0IGV4ZWN1dGluZyB0aGUgYGNvbm5lY3QoQ29ubmVjdFR5cGUuUkVBRE9OTFkpYFxuICAgKi9cbiAgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uPzogKFxuICAgIG5ldHdvcmtzOiBOZXR3b3JrSW5mb1tdLFxuICApID0+IFByb21pc2U8UmVhZG9ubHlXYWxsZXRTZXNzaW9uIHwgbnVsbD47XG5cbiAgLyoqXG4gICAqIHJ1biBhdCBleGVjdXRpbmcgdGhlIGBjb25uZWN0KENvbm5lY3RUeXBlLkNIUk9NRV9FWFRFTlNJT04pYFxuICAgKiBpZiB1c2VyIGluc3RhbGxlZCBtdWx0aXBsZSB3YWxsZXRzXG4gICAqL1xuICBzZWxlY3RDaHJvbWVFeHRlbnNpb24/OiAoXG4gICAgZXh0ZW5zaW9uSW5mb3M6IENocm9tZUV4dGVuc2lvbkluZm9bXSxcbiAgKSA9PiBQcm9taXNlPENocm9tZUV4dGVuc2lvbkluZm8gfCBudWxsPjtcblxuICAvKipcbiAgICogbWlsbGlzZWNvbmRzIHRvIHdhaXQgY2hlY2tpbmcgY2hyb21lIGV4dGVuc2lvbiBpcyBpbnN0YWxsZWRcbiAgICpcbiAgICogQGRlZmF1bHQgMTAwMCAqIDMgbWlsaXNlY29uZHNcbiAgICovXG4gIHdhaXRpbmdDaHJvbWVFeHRlbnNpb25JbnN0YWxsQ2hlY2s/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIOKaoO+4jyBUaGlzIEFQSSBpcyBhbiBvcHRpb24gZm9yIHdhbGxldCBkZXZlbG9wZXJzLiBQbGVhc2UgZG9uJ3QgdXNlIGRBcHAgZGV2ZWxvcGVycy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgXG4gICAqIDxXYWxsZXRQcm92aWRlciBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjaz17KHVzZXJBZ2VudDogc3RyaW5nKSA9PiB7XG4gICAqICAgcmV0dXJuIC9NeVdhbGxldFxcLy8udGVzdCh1c2VyQWdlbnQpO1xuICAgKiB9fT5cbiAgICogYGBgXG4gICAqL1xuICBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjaz86IChcbiAgICB1c2VyQWdlbnQ6IHN0cmluZyxcbiAgKSA9PiBib29sZWFuO1xufVxuXG5jb25zdCBDT05ORUNUSU9OUyA9IHtcbiAgW0Nvbm5lY3RUeXBlLlJFQURPTkxZXToge1xuICAgIHR5cGU6IENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgIG5hbWU6ICdWaWV3IGFuIGFkZHJlc3MnLFxuICAgIGljb246ICdodHRwczovL2Fzc2V0cy50ZXJyYS5tb25leS9pY29uL3N0YXRpb24tZXh0ZW5zaW9uL2ljb24ucG5nJyxcbiAgfSBhcyBDb25uZWN0aW9uLFxuICBbQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVF06IHtcbiAgICB0eXBlOiBDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNULFxuICAgIG5hbWU6ICdUZXJyYSBTdGF0aW9uIE1vYmlsZScsXG4gICAgaWNvbjogJ2h0dHBzOi8vYXNzZXRzLnRlcnJhLm1vbmV5L2ljb24vc3RhdGlvbi1leHRlbnNpb24vaWNvbi5wbmcnLFxuICB9IGFzIENvbm5lY3Rpb24sXG4gIFtDb25uZWN0VHlwZS5XRUJfQ09OTkVDVF06IHtcbiAgICB0eXBlOiBDb25uZWN0VHlwZS5XRUJfQ09OTkVDVCxcbiAgICBuYW1lOiAnVGVycmEgU3RhdGlvbicsXG4gICAgaWNvbjogJ2h0dHBzOi8vYXNzZXRzLnRlcnJhLm1vbmV5L2ljb24vc3RhdGlvbi1leHRlbnNpb24vaWNvbi5wbmcnLFxuICB9IGFzIENvbm5lY3Rpb24sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBkZWZhdWx0V2FpdGluZ0Nocm9tZUV4dGVuc2lvbkluc3RhbGxDaGVjayA9IDEwMDAgKiAzO1xuXG5leHBvcnQgY2xhc3MgV2FsbGV0Q29udHJvbGxlciB7XG4gIHByaXZhdGUgY2hyb21lRXh0ZW5zaW9uOiBDaHJvbWVFeHRlbnNpb25Db250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgd2ViQ29ubmVjdG9yOiBXZWJDb25uZWN0b3JDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgd2FsbGV0Q29ubmVjdDogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seVdhbGxldDogUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBfYXZhaWxhYmxlQ29ubmVjdFR5cGVzOiBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT47XG4gIHByaXZhdGUgX2F2YWlsYWJsZUluc3RhbGxUeXBlczogQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+O1xuICBwcml2YXRlIF9zdGF0ZXM6IEJlaGF2aW9yU3ViamVjdDxXYWxsZXRTdGF0ZXM+O1xuXG4gIHByaXZhdGUgZGlzYWJsZVJlYWRvbmx5V2FsbGV0OiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlQ2hyb21lRXh0ZW5zaW9uOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlV2ViRXh0ZW5zaW9uOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkaXNhYmxlV2FsbGV0Q29ubmVjdDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfbm90Q29ubmVjdGVkOiBXYWxsZXRTdGF0ZXM7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2luaXRpYWxpemluZzogV2FsbGV0U3RhdGVzO1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IG9wdGlvbnM6IFdhbGxldENvbnRyb2xsZXJPcHRpb25zKSB7XG4gICAgdGhpcy5fbm90Q29ubmVjdGVkID0ge1xuICAgICAgc3RhdHVzOiBXYWxsZXRTdGF0dXMuV0FMTEVUX05PVF9DT05ORUNURUQsXG4gICAgICBuZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgIH07XG5cbiAgICB0aGlzLl9pbml0aWFsaXppbmcgPSB7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5JTklUSUFMSVpJTkcsXG4gICAgICBuZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgIH07XG5cbiAgICB0aGlzLl9hdmFpbGFibGVDb25uZWN0VHlwZXMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+KFtcbiAgICAgIENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgICAgQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVCxcbiAgICBdKTtcblxuICAgIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Q29ubmVjdFR5cGVbXT4oW10pO1xuXG4gICAgdGhpcy5fc3RhdGVzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxXYWxsZXRTdGF0ZXM+KHRoaXMuX2luaXRpYWxpemluZyk7XG5cbiAgICBsZXQgbnVtU2Vzc2lvbkNoZWNrOiBudW1iZXIgPSAwO1xuXG4gICAgLy8gd2FpdCBjaGVja2luZyB0aGUgYXZhaWxhYmlsaXR5IG9mIHRoZSBjaHJvbWUgZXh0ZW5zaW9uXG4gICAgLy8gMC4gY2hlY2sgaWYgZXh0ZW5zaW9uIHdhbGxldCBzZXNzaW9uIGlzIGV4aXN0c1xuICAgIGNoZWNrQXZhaWxhYmxlRXh0ZW5zaW9uKFxuICAgICAgb3B0aW9ucy53YWl0aW5nQ2hyb21lRXh0ZW5zaW9uSW5zdGFsbENoZWNrID8/XG4gICAgICAgIGRlZmF1bHRXYWl0aW5nQ2hyb21lRXh0ZW5zaW9uSW5zdGFsbENoZWNrLFxuICAgICAgdGhpcy5pc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyKCksXG4gICAgKS50aGVuKChleHRlbnNpb25UeXBlKSA9PiB7XG4gICAgICBpZiAoZXh0ZW5zaW9uVHlwZSA9PT0gQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1QpIHtcbiAgICAgICAgdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzLm5leHQoW1xuICAgICAgICAgIENvbm5lY3RUeXBlLlJFQURPTkxZLFxuICAgICAgICAgIENvbm5lY3RUeXBlLldFQl9DT05ORUNULFxuICAgICAgICAgIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHRoaXMud2ViQ29ubmVjdG9yID0gbmV3IFdlYkNvbm5lY3RvckNvbnRyb2xsZXIod2luZG93KTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLndlYkNvbm5lY3RvclxuICAgICAgICAgIC5zdGF0dXMoKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgZmlsdGVyKCh3ZWJFeHRlbnNpb25TdGF0dXMpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICB3ZWJFeHRlbnNpb25TdGF0dXMudHlwZSAhPT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5JTklUSUFMSVpJTkdcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIClcbiAgICAgICAgICAuc3Vic2NyaWJlKCh3ZWJFeHRlbnNpb25TdGF0dXMpID0+IHtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHdlYkV4dGVuc2lvblN0YXR1cy50eXBlID09PSBXZWJDb25uZWN0b3JTdGF0dXNUeXBlLlJFQURZICYmXG4gICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSkgPT09ICd0cnVlJyAmJlxuICAgICAgICAgICAgICAhdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdCAmJlxuICAgICAgICAgICAgICAhdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXRcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmVuYWJsZVdlYkV4dGVuc2lvbigpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChudW1TZXNzaW9uQ2hlY2sgPT09IDApIHtcbiAgICAgICAgICAgICAgbnVtU2Vzc2lvbkNoZWNrICs9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShXRUJfRVhURU5TSU9OX0NPTk5FQ1RFRF9LRVkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChleHRlbnNpb25UeXBlID09PSBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OKSB7XG4gICAgICAgIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5uZXh0KFtcbiAgICAgICAgICBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgICBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OLFxuICAgICAgICAgIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uID0gbmV3IENocm9tZUV4dGVuc2lvbkNvbnRyb2xsZXIoe1xuICAgICAgICAgIGVuYWJsZVdhbGxldENvbm5lY3Rpb246IHRydWUsXG4gICAgICAgICAgZGVmYXVsdE5ldHdvcms6IG9wdGlvbnMuZGVmYXVsdE5ldHdvcmssXG4gICAgICAgICAgc2VsZWN0RXh0ZW5zaW9uOiBvcHRpb25zLnNlbGVjdENocm9tZUV4dGVuc2lvbixcbiAgICAgICAgICBkYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjazpcbiAgICAgICAgICAgIG9wdGlvbnMuZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2sgPz9cbiAgICAgICAgICAgIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0ssXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuY2hyb21lRXh0ZW5zaW9uXG4gICAgICAgICAgLnN0YXR1cygpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBmaWx0ZXIoKGNocm9tZUV4dGVuc2lvblN0YXR1cykgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIGNocm9tZUV4dGVuc2lvblN0YXR1cyAhPT0gQ2hyb21lRXh0ZW5zaW9uU3RhdHVzLklOSVRJQUxJWklOR1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKVxuICAgICAgICAgIC5zdWJzY3JpYmUoKGNocm9tZUV4dGVuc2lvblN0YXR1cykgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIHt9XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgY2hyb21lRXh0ZW5zaW9uU3RhdHVzID09PVxuICAgICAgICAgICAgICAgIENocm9tZUV4dGVuc2lvblN0YXR1cy5XQUxMRVRfQ09OTkVDVEVEICYmXG4gICAgICAgICAgICAgICF0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ICYmXG4gICAgICAgICAgICAgICF0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuZW5hYmxlQ2hyb21lRXh0ZW5zaW9uKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG51bVNlc3Npb25DaGVjayA9PT0gMCkge1xuICAgICAgICAgICAgICBudW1TZXNzaW9uQ2hlY2sgKz0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNEZXNrdG9wQ2hyb21lKHRoaXMuaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlcigpKSkge1xuICAgICAgICAgIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcy5uZXh0KFtDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobnVtU2Vzc2lvbkNoZWNrID09PSAwKSB7XG4gICAgICAgICAgbnVtU2Vzc2lvbkNoZWNrICs9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gMS4gY2hlY2sgaWYgcmVhZG9ubHkgd2FsbGV0IHNlc3Npb24gaXMgZXhpc3RzXG4gICAgY29uc3QgZHJhZnRSZWFkb25seVdhbGxldCA9IHJlQ29ubmVjdElmU2Vzc2lvbkV4aXN0cygpO1xuXG4gICAgaWYgKGRyYWZ0UmVhZG9ubHlXYWxsZXQpIHtcbiAgICAgIHRoaXMuZW5hYmxlUmVhZG9ubHlXYWxsZXQoZHJhZnRSZWFkb25seVdhbGxldCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gMi4gY2hlY2sgaWYgd2FsbGV0Y29ubmVjdCBzZXNpc29uIGlzIGV4aXN0c1xuICAgIGNvbnN0IGRyYWZ0V2FsbGV0Q29ubmVjdCA9IHdjQ29ubmVjdElmU2Vzc2lvbkV4aXN0cyhvcHRpb25zKTtcblxuICAgIGlmIChcbiAgICAgIGRyYWZ0V2FsbGV0Q29ubmVjdCAmJlxuICAgICAgZHJhZnRXYWxsZXRDb25uZWN0LmdldExhdGVzdFNlc3Npb24oKS5zdGF0dXMgPT09XG4gICAgICAgIFdhbGxldENvbm5lY3RTZXNzaW9uU3RhdHVzLkNPTk5FQ1RFRFxuICAgICkge1xuICAgICAgdGhpcy5lbmFibGVXYWxsZXRDb25uZWN0KGRyYWZ0V2FsbGV0Q29ubmVjdCk7XG4gICAgfSBlbHNlIGlmIChudW1TZXNzaW9uQ2hlY2sgPT09IDApIHtcbiAgICAgIG51bVNlc3Npb25DaGVjayArPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAc2VlIFdhbGxldCNpc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyICovXG4gIGlzQ2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXIgPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMub3B0aW9ucy5kYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjayA/P1xuICAgICAgREVGQVVMVF9DSFJPTUVfRVhURU5TSU9OX0NPTVBBVElCTEVfQlJPV1NFUl9DSEVDS1xuICAgICkobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2F2YWlsYWJsZUNvbm5lY3RUeXBlcyAqL1xuICBhdmFpbGFibGVDb25uZWN0VHlwZXMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0VHlwZVtdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjYXZhaWxhYmxlQ29ubmVjdGlvbnMgKi9cbiAgYXZhaWxhYmxlQ29ubmVjdGlvbnMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0aW9uW10+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzLnBpcGUoXG4gICAgICBtYXAoKGNvbm5lY3RUeXBlcykgPT4ge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uczogQ29ubmVjdGlvbltdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBjb25uZWN0VHlwZSBvZiBjb25uZWN0VHlwZXMpIHtcbiAgICAgICAgICBpZiAoY29ubmVjdFR5cGUgPT09IENvbm5lY3RUeXBlLkNIUk9NRV9FWFRFTlNJT04pIHtcbiAgICAgICAgICAgIGNvbnN0IHRlcnJhRXh0ZW5zaW9ucyA9IGdldFRlcnJhQ2hyb21lRXh0ZW5zaW9ucygpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRlcnJhRXh0ZW5zaW9uIG9mIHRlcnJhRXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgICBjb25uZWN0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OLFxuICAgICAgICAgICAgICAgIC4uLnRlcnJhRXh0ZW5zaW9uLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29ubmVjdGlvbnMucHVzaChDT05ORUNUSU9OU1tjb25uZWN0VHlwZV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb25uZWN0aW9ucztcbiAgICAgIH0pLFxuICAgICk7XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2F2YWlsYWJsZUluc3RhbGxUeXBlcyAqL1xuICBhdmFpbGFibGVJbnN0YWxsVHlwZXMgPSAoKTogT2JzZXJ2YWJsZTxDb25uZWN0VHlwZVtdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZUluc3RhbGxUeXBlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKipcbiAgICogQHNlZSBXYWxsZXQjc3RhdHVzXG4gICAqIEBzZWUgV2FsbGV0I25ldHdvcmtcbiAgICogQHNlZSBXYWxsZXQjd2FsbGV0c1xuICAgKi9cbiAgc3RhdGVzID0gKCk6IE9ic2VydmFibGU8V2FsbGV0U3RhdGVzPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlcy5hc09ic2VydmFibGUoKTtcbiAgfTtcblxuICAvKiogQGRlcHJlY2F0ZWQgcGxlYXNlIHVzZSBgc3RhdGVzKClgICovXG4gIHN0YXR1cyA9ICgpOiBPYnNlcnZhYmxlPFdhbGxldFN0YXR1cz4gPT4ge1xuICAgIHJldHVybiB0aGlzLl9zdGF0ZXMucGlwZShtYXAoKGRhdGEpID0+IGRhdGEuc3RhdHVzKSk7XG4gIH07XG5cbiAgLyoqIEBkZXByZWNhdGVkIHBsZWFzZSB1c2UgYHN0YXRlcygpYCAqL1xuICBuZXR3b3JrID0gKCk6IE9ic2VydmFibGU8TmV0d29ya0luZm8+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdGVzLnBpcGUobWFwKChkYXRhKSA9PiBkYXRhLm5ldHdvcmspKTtcbiAgfTtcblxuICAvKiogQGRlcHJlY2F0ZWQgcGxlYXNlIHVzZSBgc3RhdGVzKClgICovXG4gIHdhbGxldHMgPSAoKTogT2JzZXJ2YWJsZTxXYWxsZXRJbmZvW10+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdGVzLnBpcGUoXG4gICAgICBtYXAoKGRhdGEpID0+XG4gICAgICAgIGRhdGEuc3RhdHVzID09PSBXYWxsZXRTdGF0dXMuV0FMTEVUX0NPTk5FQ1RFRCA/IGRhdGEud2FsbGV0cyA6IFtdLFxuICAgICAgKSxcbiAgICApO1xuICB9O1xuXG4gIC8qKiBAc2VlIFdhbGxldCNyZWNoZWNrU3RhdHVzICovXG4gIHJlY2hlY2tTdGF0dXMgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbikge1xuICAgICAgdGhpcy5jaHJvbWVFeHRlbnNpb24/LnJlY2hlY2tTdGF0dXMoKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2luc3RhbGwgKi9cbiAgaW5zdGFsbCA9ICh0eXBlOiBDb25uZWN0VHlwZSkgPT4ge1xuICAgIGlmICh0eXBlID09PSBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OKSB7XG4gICAgICB3aW5kb3cub3BlbihDSFJPTUVfRVhURU5TSU9OX0lOU1RBTExfVVJMLCAnX2JsYW5rJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBDb25uZWN0VHlwZS5XRUJfQ09OTkVDVCkge1xuICAgICAgY29uc3Qgd2ViRXh0ZW5zaW9uU3RhdHVzID0gdGhpcy53ZWJDb25uZWN0b3I/LmdldExhc3RTdGF0dXMoKTtcbiAgICAgIGlmIChcbiAgICAgICAgd2ViRXh0ZW5zaW9uU3RhdHVzPy50eXBlID09PSBXZWJDb25uZWN0b3JTdGF0dXNUeXBlLk5PX0FWQUlMQUJMRSAmJlxuICAgICAgICB3ZWJFeHRlbnNpb25TdGF0dXMuaW5zdGFsbExpbmtcbiAgICAgICkge1xuICAgICAgICB3aW5kb3cub3Blbih3ZWJFeHRlbnNpb25TdGF0dXMuaW5zdGFsbExpbmssICdfYmxhbmsnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKGBDb25uZWN0VHlwZSBcIiR7dHlwZX1cIiBkb2VzIG5vdCBzdXBwb3J0IGluc3RhbGwoKSBmdW5jdGlvbmApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjY29ubmVjdCAqL1xuICBjb25uZWN0ID0gKHR5cGU6IENvbm5lY3RUeXBlLCBpZGVudGlmaWVyPzogc3RyaW5nKSA9PiB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLlJFQURPTkxZOlxuICAgICAgICBjb25zdCBuZXR3b3JrczogTmV0d29ya0luZm9bXSA9IE9iamVjdC5rZXlzKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy53YWxsZXRDb25uZWN0Q2hhaW5JZHMsXG4gICAgICAgICkubWFwKChjaGFpbklkKSA9PiB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzWytjaGFpbklkXSk7XG5cbiAgICAgICAgY29uc3QgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uID1cbiAgICAgICAgICB0aGlzLm9wdGlvbnMuY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uPy4obmV0d29ya3MpID8/XG4gICAgICAgICAgcmVhZG9ubHlXYWxsZXRNb2RhbCh7IG5ldHdvcmtzIH0pO1xuXG4gICAgICAgIGNyZWF0ZVJlYWRvbmx5V2FsbGV0U2Vzc2lvbi50aGVuKChyZWFkb25seVdhbGxldFNlc3Npb24pID0+IHtcbiAgICAgICAgICBpZiAocmVhZG9ubHlXYWxsZXRTZXNzaW9uKSB7XG4gICAgICAgICAgICB0aGlzLmVuYWJsZVJlYWRvbmx5V2FsbGV0KHJlQ29ubmVjdChyZWFkb25seVdhbGxldFNlc3Npb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ29ubmVjdFR5cGUuV0FMTEVUQ09OTkVDVDpcbiAgICAgICAgdGhpcy5lbmFibGVXYWxsZXRDb25uZWN0KHdjQ29ubmVjdCh0aGlzLm9wdGlvbnMpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLkNIUk9NRV9FWFRFTlNJT046XG4gICAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uIS5jb25uZWN0KGlkZW50aWZpZXIpLnRoZW4oKHN1Y2Nlc3MpID0+IHtcbiAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgdGhpcy5lbmFibGVDaHJvbWVFeHRlbnNpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1Q6XG4gICAgICAgIHRoaXMuZW5hYmxlV2ViRXh0ZW5zaW9uKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIENvbm5lY3RUeXBlIWApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjY29ubmVjdFJlYWRvbmx5ICovXG4gIGNvbm5lY3RSZWFkb25seSA9ICh0ZXJyYUFkZHJlc3M6IHN0cmluZywgbmV0d29yazogTmV0d29ya0luZm8pID0+IHtcbiAgICB0aGlzLmVuYWJsZVJlYWRvbmx5V2FsbGV0KFxuICAgICAgcmVDb25uZWN0KHtcbiAgICAgICAgdGVycmFBZGRyZXNzLFxuICAgICAgICBuZXR3b3JrLFxuICAgICAgfSksXG4gICAgKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjZGlzY29ubmVjdCAqL1xuICBkaXNjb25uZWN0ID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldCA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24/LigpO1xuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuICAgIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gbnVsbDtcblxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSk7XG4gICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjcG9zdCAqL1xuICBwb3N0ID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgLy8gVE9ETyBub3Qgd29yayBhdCB0aGlzIHRpbWUuIGZvciB0aGUgZnV0dXJlIGV4dGVuc2lvblxuICAgIHR4VGFyZ2V0OiB7IHRlcnJhQWRkcmVzcz86IHN0cmluZyB9ID0ge30sXG4gICk6IFByb21pc2U8VHhSZXN1bHQ+ID0+IHtcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBjaHJvbWUgZXh0ZW5zaW9uIC0gbGVnYWN5IGV4dGVuc2lvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGlmICh0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgIGlmICghdGhpcy5jaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBjaHJvbWVFeHRlbnNpb24gaW5zdGFuY2Ugbm90IGNyZWF0ZWQhYCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uXG4gICAgICAgICAgLy8gVE9ETyBtYWtlIFdhbGxldENvbm5lY3RUeFJlc3VsdCB0byBjb21tb24gdHlwZVxuICAgICAgICAgIC5wb3N0PENyZWF0ZVR4T3B0aW9ucywgeyByZXN1bHQ6IFdhbGxldENvbm5lY3RUeFJlc3VsdCB9Pih0eClcbiAgICAgICAgICAudGhlbigoeyBwYXlsb2FkIH0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnR4LFxuICAgICAgICAgICAgICByZXN1bHQ6IHBheWxvYWQucmVzdWx0LFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgfSBhcyBUeFJlc3VsdDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIENocm9tZUV4dGVuc2lvbkNyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBDcmVhdGVUeEZhaWxlZCh0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR4RmFpbGVkKHR4LCBlcnJvci50eGhhc2gsIGVycm9yLm1lc3NhZ2UsIG51bGwpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIENocm9tZUV4dGVuc2lvblVuc3BlY2lmaWVkRXJyb3IpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR4VW5zcGVjaWZpZWRFcnJvcih0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBVc2VyRGVuaWVkRXJyb3JcbiAgICAgICAgICAgIC8vIEFsbCB1bnNwZWNpZmllZCBlcnJvcnMuLi5cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyB3ZWIgZXh0ZW5zaW9uIC0gbmV3IGV4dGVuc2lvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGVsc2UgaWYgKHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFR4UmVzdWx0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGlmICghdGhpcy53ZWJDb25uZWN0b3IpIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKGB3ZWJFeHRlbnNpb24gaW5zdGFuY2Ugbm90IGNyZWF0ZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdlYkV4dGVuc2lvblN0YXRlcyA9IHRoaXMud2ViQ29ubmVjdG9yLmdldExhc3RTdGF0ZXMoKTtcblxuICAgICAgICBpZiAoIXdlYkV4dGVuc2lvblN0YXRlcykge1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYHdlYkV4dGVuc2lvbi5nZXRMYXN0U3RhdGVzKCkgcmV0dXJucyB1bmRlZmluZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZvY3VzZWRXYWxsZXQgPSB0eFRhcmdldC50ZXJyYUFkZHJlc3NcbiAgICAgICAgICA/IHdlYkV4dGVuc2lvblN0YXRlcy53YWxsZXRzLmZpbmQoXG4gICAgICAgICAgICAgIChpdGVtV2FsbGV0KSA9PiBpdGVtV2FsbGV0LnRlcnJhQWRkcmVzcyA9PT0gdHhUYXJnZXQudGVycmFBZGRyZXNzLFxuICAgICAgICAgICAgKSA/PyB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0c1swXVxuICAgICAgICAgIDogd2ViRXh0ZW5zaW9uU3RhdGVzLmZvY3VzZWRXYWxsZXRBZGRyZXNzXG4gICAgICAgICAgPyB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0cy5maW5kKFxuICAgICAgICAgICAgICAoaXRlbVdhbGxldCkgPT5cbiAgICAgICAgICAgICAgICBpdGVtV2FsbGV0LnRlcnJhQWRkcmVzcyA9PT1cbiAgICAgICAgICAgICAgICB3ZWJFeHRlbnNpb25TdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3MsXG4gICAgICAgICAgICApID8/IHdlYkV4dGVuc2lvblN0YXRlcy53YWxsZXRzWzBdXG4gICAgICAgICAgOiB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0c1swXTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLndlYkNvbm5lY3RvclxuICAgICAgICAgIC5wb3N0KGZvY3VzZWRXYWxsZXQudGVycmFBZGRyZXNzLCB0eClcbiAgICAgICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgIG5leHQ6IChleHRlbnNpb25UeFJlc3VsdDogV2ViQ29ubmVjdG9yVHhSZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgc3dpdGNoIChleHRlbnNpb25UeFJlc3VsdC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFdlYkNvbm5lY3RvclR4U3RhdHVzLlNVQ0NFRUQ6XG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udHgsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdDogZXh0ZW5zaW9uVHhSZXN1bHQucGF5bG9hZCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgV2ViQ29ubmVjdG9yVXNlckRlbmllZCkge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgVXNlckRlbmllZCgpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdlYkNvbm5lY3RvckNyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBDcmVhdGVUeEZhaWxlZCh0eCwgZXJyb3IubWVzc2FnZSkpO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgV2ViQ29ubmVjdG9yVHhGYWlsZWQpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoXG4gICAgICAgICAgICAgICAgICBuZXcgVHhGYWlsZWQoXG4gICAgICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgICAgICBlcnJvci50eGhhc2gsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLnJhd19tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlamVjdChcbiAgICAgICAgICAgICAgICAgIG5ldyBUeFVuc3BlY2lmaWVkRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgaW4gZXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gd2FsbGV0IGNvbm5lY3RcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBlbHNlIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHJldHVybiB0aGlzLndhbGxldENvbm5lY3RcbiAgICAgICAgLnBvc3QodHgpXG4gICAgICAgIC50aGVuKFxuICAgICAgICAgIChyZXN1bHQpID0+XG4gICAgICAgICAgICAoe1xuICAgICAgICAgICAgICAuLi50eCxcbiAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgfSBhcyBUeFJlc3VsdCksXG4gICAgICAgIClcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIGxldCB0aHJvd0Vycm9yID0gZXJyb3I7XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgV2FsbGV0Q29ubmVjdFVzZXJEZW5pZWQpIHtcbiAgICAgICAgICAgICAgdGhyb3dFcnJvciA9IG5ldyBVc2VyRGVuaWVkKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgV2FsbGV0Q29ubmVjdENyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgQ3JlYXRlVHhGYWlsZWQodHgsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdhbGxldENvbm5lY3RUeEZhaWxlZCkge1xuICAgICAgICAgICAgICB0aHJvd0Vycm9yID0gbmV3IFR4RmFpbGVkKFxuICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgIGVycm9yLnR4aGFzaCxcbiAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIGVycm9yLnJhd19tZXNzYWdlLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdhbGxldENvbm5lY3RUaW1lb3V0KSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVGltZW91dChlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBXYWxsZXRDb25uZWN0VHhVbnNwZWNpZmllZEVycm9yKSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVHhVbnNwZWNpZmllZEVycm9yKHR4LCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVHhVbnNwZWNpZmllZEVycm9yKFxuICAgICAgICAgICAgICB0eCxcbiAgICAgICAgICAgICAgJ21lc3NhZ2UnIGluIGVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRocm93IHRocm93RXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIGFyZSBubyBjb25uZWN0aW9ucyB0aGF0IGNhbiBiZSBwb3N0aW5nIHR4IWApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjc2lnbiAqL1xuICBzaWduID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgLy8gVE9ETyBub3Qgd29yayBhdCB0aGlzIHRpbWUuIGZvciB0aGUgZnV0dXJlIGV4dGVuc2lvblxuICAgIHR4VGFyZ2V0OiB7IHRlcnJhQWRkcmVzcz86IHN0cmluZyB9ID0ge30sXG4gICk6IFByb21pc2U8U2lnblJlc3VsdD4gPT4ge1xuICAgIGludGVyZmFjZSBTaWduUmVzdWx0UmF3IGV4dGVuZHMgQ3JlYXRlVHhPcHRpb25zIHtcbiAgICAgIHJlc3VsdDoge1xuICAgICAgICBwdWJsaWNfa2V5OiBzdHJpbmcgfCBQdWJsaWNLZXkuRGF0YTtcbiAgICAgICAgcmVjaWQ6IG51bWJlcjtcbiAgICAgICAgc2lnbmF0dXJlOiBzdHJpbmc7XG4gICAgICAgIHN0ZFNpZ25Nc2dEYXRhOiBTdGRTaWduTXNnLkRhdGE7XG4gICAgICB9O1xuICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kaXNhYmxlQ2hyb21lRXh0ZW5zaW9uKSB7XG4gICAgICBpZiAoIXRoaXMuY2hyb21lRXh0ZW5zaW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgY2hyb21lRXh0ZW5zaW9uIGluc3RhbmNlIG5vdCBjcmVhdGVkIWApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jaHJvbWVFeHRlbnNpb25cbiAgICAgICAgLnNpZ248Q3JlYXRlVHhPcHRpb25zLCBTaWduUmVzdWx0UmF3Pih0eClcbiAgICAgICAgLnRoZW4oKHsgcGF5bG9hZCB9KSA9PiB7XG4gICAgICAgICAgY29uc3QgcHVibGljS2V5OiBQdWJsaWNLZXkuRGF0YSA9XG4gICAgICAgICAgICB0eXBlb2YgcGF5bG9hZC5yZXN1bHQucHVibGljX2tleSA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAndGVuZGVybWludC9QdWJLZXlTZWNwMjU2azEnLFxuICAgICAgICAgICAgICAgICAgdmFsdWU6IHBheWxvYWQucmVzdWx0LnB1YmxpY19rZXksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHBheWxvYWQucmVzdWx0LnB1YmxpY19rZXk7XG5cbiAgICAgICAgICBjb25zdCBzaWduUmVzdWx0OiBTaWduUmVzdWx0WydyZXN1bHQnXSA9IHtcbiAgICAgICAgICAgIC4uLnBheWxvYWQucmVzdWx0LFxuICAgICAgICAgICAgcHVibGljX2tleTogcHVibGljS2V5LFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4udHgsXG4gICAgICAgICAgICByZXN1bHQ6IHNpZ25SZXN1bHQsXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBDaHJvbWVFeHRlbnNpb25DcmVhdGVUeEZhaWxlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IENyZWF0ZVR4RmFpbGVkKHR4LCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeEZhaWxlZCh0eCwgZXJyb3IudHhoYXNoLCBlcnJvci5tZXNzYWdlLCBudWxsKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVW5zcGVjaWZpZWRFcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR4VW5zcGVjaWZpZWRFcnJvcih0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFVzZXJEZW5pZWQgLSBjaHJvbWUgZXh0ZW5zaW9uIHdpbGwgc2VudCBvcmlnaW5hbCBVc2VyRGVuaWVkIGVycm9yIHR5cGVcbiAgICAgICAgICAvLyBBbGwgdW5zcGVjaWZpZWQgZXJyb3JzLi4uXG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgc2lnbigpIG1ldGhvZCBvbmx5IGF2YWlsYWJsZSBvbiBjaHJvbWUgZXh0ZW5zaW9uYCk7XG4gICAgLy8gVE9ETyBpbXBsZW1lbnRzIHNpZ24oKSB0byBvdGhlciBjb25uZWN0IHR5cGVzXG4gIH07XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBpbnRlcm5hbFxuICAvLyBjb25uZWN0IHR5cGUgY2hhbmdpbmdcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBwcml2YXRlIHVwZGF0ZVN0YXRlcyA9IChuZXh0OiBXYWxsZXRTdGF0ZXMpID0+IHtcbiAgICBjb25zdCBwcmV2ID0gdGhpcy5fc3RhdGVzLmdldFZhbHVlKCk7XG5cbiAgICBpZiAoXG4gICAgICBuZXh0LnN0YXR1cyA9PT0gV2FsbGV0U3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgIG5leHQud2FsbGV0cy5sZW5ndGggPT09IDBcbiAgICApIHtcbiAgICAgIGNvbnNvbGUudHJhY2UoJz8/PycpO1xuICAgIH1cblxuICAgIGlmIChwcmV2LnN0YXR1cyAhPT0gbmV4dC5zdGF0dXMgfHwgIWRlZXBFcXVhbChwcmV2LCBuZXh0KSkge1xuICAgICAgdGhpcy5fc3RhdGVzLm5leHQobmV4dCk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlUmVhZG9ubHlXYWxsZXQgPSAocmVhZG9ubHlXYWxsZXQ6IFJlYWRvbmx5V2FsbGV0Q29udHJvbGxlcikgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3Q/LigpO1xuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbj8uKCk7XG4gICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uPy4oKTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMucmVhZG9ubHlXYWxsZXQgPT09IHJlYWRvbmx5V2FsbGV0IHx8XG4gICAgICAodGhpcy5yZWFkb25seVdhbGxldD8udGVycmFBZGRyZXNzID09PSByZWFkb25seVdhbGxldC50ZXJyYUFkZHJlc3MgJiZcbiAgICAgICAgdGhpcy5yZWFkb25seVdhbGxldC5uZXR3b3JrID09PSByZWFkb25seVdhbGxldC5uZXR3b3JrKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlYWRvbmx5V2FsbGV0KSB7XG4gICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0LmRpc2Nvbm5lY3QoKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlYWRvbmx5V2FsbGV0ID0gcmVhZG9ubHlXYWxsZXQ7XG5cbiAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgbmV0d29yazogcmVhZG9ubHlXYWxsZXQubmV0d29yayxcbiAgICAgIHdhbGxldHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNvbm5lY3RUeXBlOiBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgICB0ZXJyYUFkZHJlc3M6IHJlYWRvbmx5V2FsbGV0LnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICBkZXNpZ246ICdyZWFkb25seScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXQgPSAoKSA9PiB7XG4gICAgICByZWFkb25seVdhbGxldC5kaXNjb25uZWN0KCk7XG4gICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0ID0gbnVsbDtcbiAgICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0ID0gbnVsbDtcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlV2ViRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbiB8fCAhdGhpcy53ZWJDb25uZWN0b3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb25TdWJzY3JpcHRpb24gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMud2ViQ29ubmVjdG9yLnN0YXR1cygpLFxuICAgICAgdGhpcy53ZWJDb25uZWN0b3Iuc3RhdGVzKCksXG4gICAgXSkuc3Vic2NyaWJlKChbc3RhdHVzLCBzdGF0ZXNdKSA9PiB7XG4gICAgICBpZiAoIXN0YXRlcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0dXMudHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5SRUFEWSkge1xuICAgICAgICBpZiAoc3RhdGVzLndhbGxldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IGZvY3VzZWRXYWxsZXQgPSBzdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3NcbiAgICAgICAgICAgID8gc3RhdGVzLndhbGxldHMuZmluZChcbiAgICAgICAgICAgICAgICAoaXRlbVdhbGxldCkgPT5cbiAgICAgICAgICAgICAgICAgIGl0ZW1XYWxsZXQudGVycmFBZGRyZXNzID09PSBzdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3MsXG4gICAgICAgICAgICAgICkgPz8gc3RhdGVzLndhbGxldHNbMF1cbiAgICAgICAgICAgIDogc3RhdGVzLndhbGxldHNbMF07XG5cbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgbmV0d29yazogc3RhdGVzLm5ldHdvcmssXG4gICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1QsXG4gICAgICAgICAgICAgICAgdGVycmFBZGRyZXNzOiBmb2N1c2VkV2FsbGV0LnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZXNpZ246IGZvY3VzZWRXYWxsZXQuZGVzaWduLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzdGF0dXMudHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5OT19BVkFJTEFCTEUpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oV0VCX0VYVEVOU0lPTl9DT05ORUNURURfS0VZKTtcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcblxuICAgICAgICBpZiAoIXN0YXR1cy5pc0FwcHJvdmVkICYmIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbikge1xuICAgICAgICAgIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShXRUJfRVhURU5TSU9OX0NPTk5FQ1RFRF9LRVksICd0cnVlJyk7XG5cbiAgICBjb25zdCBsYXN0RXh0ZW5zaW9uU3RhdHVzID0gdGhpcy53ZWJDb25uZWN0b3IuZ2V0TGFzdFN0YXR1cygpO1xuXG4gICAgaWYgKFxuICAgICAgbGFzdEV4dGVuc2lvblN0YXR1cy50eXBlID09PSBXZWJDb25uZWN0b3JTdGF0dXNUeXBlLk5PX0FWQUlMQUJMRSAmJlxuICAgICAgbGFzdEV4dGVuc2lvblN0YXR1cy5pc0FwcHJvdmVkID09PSBmYWxzZVxuICAgICkge1xuICAgICAgdGhpcy53ZWJDb25uZWN0b3IucmVxdWVzdEFwcHJvdmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oV0VCX0VYVEVOU0lPTl9DT05ORUNURURfS0VZKTtcbiAgICAgIGV4dGVuc2lvblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uID0gbnVsbDtcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlQ2hyb21lRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiB8fCAhdGhpcy5jaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb25TdWJzY3JpcHRpb24gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uLnN0YXR1cygpLFxuICAgICAgdGhpcy5jaHJvbWVFeHRlbnNpb24ubmV0d29ya0luZm8oKSxcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uLnRlcnJhQWRkcmVzcygpLFxuICAgIF0pLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAoW3N0YXR1cywgbmV0d29ya0luZm8sIHRlcnJhQWRkcmVzc10pID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHN0YXR1cyA9PT0gQ2hyb21lRXh0ZW5zaW9uU3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgICAgICB0eXBlb2YgdGVycmFBZGRyZXNzID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgIEFjY0FkZHJlc3MudmFsaWRhdGUodGVycmFBZGRyZXNzKVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgbmV0d29yazogbmV0d29ya0luZm8sXG4gICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUuQ0hST01FX0VYVEVOU0lPTixcbiAgICAgICAgICAgICAgICB0ZXJyYUFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZGVzaWduOiAnZXh0ZW5zaW9uJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9ICgpID0+IHtcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uPy5kaXNjb25uZWN0KCk7XG4gICAgICBleHRlbnNpb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9IG51bGw7XG4gICAgfTtcbiAgfTtcblxuICBwcml2YXRlIGVuYWJsZVdhbGxldENvbm5lY3QgPSAod2FsbGV0Q29ubmVjdDogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIpID0+IHtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlQ2hyb21lRXh0ZW5zaW9uPy4oKTtcbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMud2FsbGV0Q29ubmVjdCA9PT0gd2FsbGV0Q29ubmVjdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdC5kaXNjb25uZWN0KCk7XG4gICAgfVxuXG4gICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcblxuICAgIGNvbnN0IHN1YnNjcmliZVdhbGxldENvbm5lY3QgPSAoXG4gICAgICB3YzogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIsXG4gICAgKTogU3Vic2NyaXB0aW9uID0+IHtcbiAgICAgIHJldHVybiB3Yy5zZXNzaW9uKCkuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKHN0YXR1cykgPT4ge1xuICAgICAgICAgIHN3aXRjaCAoc3RhdHVzLnN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBXYWxsZXRDb25uZWN0U2Vzc2lvblN0YXR1cy5DT05ORUNURUQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgICAgIG5ldHdvcms6XG4gICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzW3N0YXR1cy5jaGFpbklkXSA/P1xuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgICAgICAgICAgICAgIHdhbGxldHM6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdFR5cGU6IENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhQWRkcmVzczogc3RhdHVzLnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgZGVzaWduOiAnd2FsbGV0Y29ubmVjdCcsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCB3YWxsZXRDb25uZWN0U2Vzc2lvblN1YnNjcmlwdGlvbiA9XG4gICAgICBzdWJzY3JpYmVXYWxsZXRDb25uZWN0KHdhbGxldENvbm5lY3QpO1xuXG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdCA9ICgpID0+IHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdD8uZGlzY29ubmVjdCgpO1xuICAgICAgdGhpcy53YWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICAgIHdhbGxldENvbm5lY3RTZXNzaW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICB9O1xuICB9O1xufVxuIl19